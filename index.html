<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>SYSTEM ACQ PRO - Sistema Operativo Immobiliare + Video Creator</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* ============================================
       VARIABLES ROOT (Unified from both codes)
    ============================================ */
    :root{
      /* Core palette from Code B */
      --bg:#0b1120;
      --text:#f3f4f6;
      --muted:#a0adb8;
      --gold:#d8a23a;
      --border: rgba(225,225,225,0.18);
      --shadow: 0 14px 50px rgba(0,0,0,0.45);
      --radius: 18px;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      
      /* Additional from Code B */
      --primary: #d8a23a;
      --secondary: #2c3e50;
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
      --light: #ecf0f1;
      --dark: #2c3e50;
      
      /* Video Creator specific (from Code A) */
      --tele-font: 12px;
      --tele-line: 1.22;
      --stage-w: min(420px, 92vw);
      --zoom: 1;
    }

    /* ============================================
       BASE STYLES (Merged from both)
    ============================================ */
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(216,162,58,.18), transparent 60%),
        radial-gradient(900px 600px at 85% 30%, rgba(123,79,189,.14), transparent 55%),
        radial-gradient(900px 600px at 70% 85%, rgba(74,143,114,.14), transparent 55%),
        var(--bg);
      line-height: 1.5;
    }

    .wrap{ 
      max-width:1250px; 
      margin:0 auto; 
      padding:14px 12px 84px; 
    }

    /* ============================================
       HEADER & NAVIGATION (From Code B)
    ============================================ */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(11, 17, 32, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 15px 0;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-badge {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, rgba(216, 162, 58, 0.2), rgba(11, 17, 32, 0.8));
      border: 2px solid rgba(216, 162, 58, 0.3);
      border-radius: 12px;
      display: grid;
      place-items: center;
      font-family: var(--mono);
      font-weight: 800;
      font-size: 1.5rem;
      color: var(--gold);
    }

    .logo-text h1 {
      font-size: 1.6rem;
      margin: 0;
      background: linear-gradient(90deg, var(--gold), #f3f4f6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo-text .subtitle {
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .status-pills {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .pill {
      font-size: 0.75rem;
      padding: 6px 12px;
      border-radius: 20px;
      border: 1px solid rgba(160, 173, 184, 0.3);
      background: rgba(160, 173, 184, 0.1);
      color: var(--muted);
    }

    .pill.highlight {
      border-color: var(--gold);
      background: rgba(216, 162, 58, 0.1);
      color: var(--gold);
    }

    /* ============================================
       WHATSAPP CTA (From Code B)
    ============================================ */
    .whatsapp-cta {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 100;
    }

    .whatsapp-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #25D366;
      color: white;
      padding: 16px 24px;
      border-radius: 50px;
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
      box-shadow: 0 10px 30px rgba(37, 211, 102, 0.3);
      transition: all 0.3s;
    }

    .whatsapp-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(37, 211, 102, 0.4);
    }

    /* ============================================
       HERO SECTION (From Code B)
    ============================================ */
    .hero {
      text-align: center;
      padding: 60px 0 40px;
      max-width: 800px;
      margin: 0 auto;
    }

    .hero h2 {
      font-size: 2.8rem;
      margin-bottom: 20px;
      line-height: 1.2;
      background: linear-gradient(90deg, var(--gold), #ffffff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero p {
      font-size: 1.2rem;
      color: var(--muted);
      margin-bottom: 30px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
    }

    /* ============================================
       SCARCITY BANNER (From Code B)
    ============================================ */
    .scarcity-banner {
      background: rgba(216, 162, 58, 0.1);
      border: 1px solid var(--gold);
      border-radius: var(--radius);
      padding: 20px;
      margin: 30px auto;
      max-width: 600px;
      text-align: center;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    .scarcity-banner h3 {
      color: var(--gold);
      margin: 0 0 10px 0;
      font-size: 1.3rem;
    }

    .slot-counter {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--gold);
      font-family: var(--mono);
      margin: 10px 0;
    }

    .scarcity-note {
      font-size: 0.85rem;
      color: var(--muted);
      font-style: italic;
    }

    /* ============================================
       TABS SYSTEM (From Code B - Expanded)
    ============================================ */
    .tabs-container {
      background: rgba(18, 24, 38, 0.8);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      margin: 40px 0;
    }

    .tabs-header {
      display: flex;
      flex-wrap: wrap;
      border-bottom: 1px solid var(--border);
      background: rgba(11, 17, 32, 0.6);
    }

    .tab-btn {
      padding: 18px 24px;
      background: none;
      border: none;
      color: var(--muted);
      font-family: var(--sans);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      flex: 1;
      min-width: 150px;
      text-align: center;
    }

    .tab-btn:hover {
      background: rgba(216, 162, 58, 0.1);
      color: var(--gold);
    }

    .tab-btn.active {
      background: rgba(216, 162, 58, 0.15);
      color: var(--gold);
      border-bottom: 2px solid var(--gold);
    }

    .tab-content {
      display: none;
      padding: 30px;
    }

    .tab-content.active {
      display: block;
    }

    /* ============================================
       BUTTONS (From Code A with enhancements)
    ============================================ */
    .btn{
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      font-weight:950;
      letter-spacing:.2px;
      font-size:11px;
      line-height:1;
      white-space:nowrap;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
      position:relative;

      transform: translateY(0) scale(1);
      transition: transform .14s ease, filter .14s ease, box-shadow .14s ease, border-color .14s ease;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
      overflow:hidden;
    }
    .btn::after{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(500px 140px at 20% 0%, rgba(255,255,255,.14), transparent 60%),
                  radial-gradient(500px 140px at 80% 100%, rgba(255,255,255,.10), transparent 55%);
      opacity:0;
      transition: opacity .18s ease;
      pointer-events:none;
    }
    .btn:hover{
      transform: translateY(-2px) scale(1.01);
      border-color: rgba(216,162,58,.22);
      box-shadow: 0 14px 34px rgba(0,0,0,.30);
      filter: brightness(1.06);
    }
    .btn:hover::after{ opacity:1; }
    .btn:active{
      transform: translateY(0px) scale(.99);
      filter: brightness(0.98);
    }

    .btn.tiny{
      padding:6px 9px;
      font-size:10px;
      border-radius:11px;
      box-shadow:none;
    }

    .btn.primary{
      background: linear-gradient(135deg, rgba(216,162,58,.95), rgba(216,162,58,.72));
      color:#111;
      border-color: rgba(216,162,58,.55);
    }
    .btn.blue{
      background: linear-gradient(135deg, rgba(57,90,140,.95), rgba(57,90,140,.70));
      border-color: rgba(57,90,140,.55);
    }
    .btn.violet{
      background: linear-gradient(135deg, rgba(123,79,189,.95), rgba(123,79,189,.70));
      border-color: rgba(123,79,189,.55);
    }
    .btn.gray{ background: rgba(255,255,255,.04); }

    /* REC button (rosso, "alive") */
    .btn.rec{
      background: linear-gradient(135deg, rgba(255,45,45,.95), rgba(255,45,45,.55));
      border-color: rgba(255,45,45,.55);
      color:#120707;
      font-weight: 1000;
    }
    .btn.rec .dot{
      width:10px; height:10px; border-radius:999px;
      background:#ff2d2d;
      box-shadow: 0 0 0 0 rgba(255,45,45,.45);
      animation: pulseDot 1.15s ease-in-out infinite;
    }
    @keyframes pulseDot{
      0%{ box-shadow: 0 0 0 0 rgba(255,45,45,.45); transform: scale(1); }
      60%{ box-shadow: 0 0 0 10px rgba(255,45,45,0); transform: scale(1.06); }
      100%{ box-shadow: 0 0 0 0 rgba(255,45,45,0); transform: scale(1); }
    }

    .btn .ico{
      display:inline-flex;
      transform: translateY(0);
      transition: transform .16s ease;
    }
    .btn:hover .ico{
      transform: translateY(-1px) rotate(-2deg);
    }

    /* ============================================
       VIDEO CREATOR SPECIFIC (From Code A)
    ============================================ */
    /* Layout */
    .layout{
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:12px;
      align-items:start;
      margin-top:12px;
    }
    @media (max-width: 980px){ .layout{ grid-template-columns:1fr; } }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .section{ padding:12px; }
    .section + .section{ border-top:1px solid rgba(255,255,255,.10); }

    .h{
      margin:0 0 8px;
      font-size:10px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.8px;
      font-weight:950;
    }

    .stageRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      align-items:start;
    }
    @media (max-width: 980px){ .stageRow{ grid-template-columns:1fr; } }

    .stageBlock{
      width: var(--stage-w);
      margin: 0 auto;
      display:flex;
      flex-direction:column;
      align-items:stretch;
    }

    #stage916{
      width: 100%;
      aspect-ratio: 9 / 16;
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      overflow: hidden;
      position: relative;
      background:#000;
      box-shadow: var(--shadow);
    }

    #cam{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      transform: scale(var(--zoom));
      transform-origin: center;
    }

    #overlay{
      position:absolute;
      inset:0;
      padding: 10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      pointer-events:none;
      z-index: 2;
    }

    #questionBoxOverlay{
      font-size: 11px;
      font-weight: 950;
      line-height: 1.15;
      padding: 7px 9px;
      border-radius: 12px;
      background: rgba(0,0,0,.30);
      border: 1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(6px);
      white-space:pre-wrap;
    }

    #teleprompterOverlay{
      flex: 1;
      position: relative;
      overflow: hidden;
      border-radius: 12px;
    }

    #teleText{
      position:absolute;
      left:0; right:0;
      white-space: pre-wrap;
      font-size: var(--tele-font);
      line-height: var(--tele-line);
      font-weight: 800;
      color: rgba(243,244,246,.94);
      text-shadow: 0 2px 12px rgba(0,0,0,.75);
      transform: translateY(20px);
    }

    .controlsRow{
      margin-top:10px;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:stretch;
    }
    .bar{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:center;
      align-items:center;
    }
    .bar.left{ justify-content:flex-start; }
    .bar.between{ justify-content:space-between; }

    .sliderRow{
      display:flex;
      align-items:center;
      gap:8px;
      color:var(--muted);
      font-size:10px;
      font-weight:950;
      flex-wrap:wrap;
      justify-content:center;
    }
    input[type="range"]{ width:170px; accent-color: var(--gold); }

    .chk{
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
      color:var(--muted);
      font-weight:950;
      font-size:10px;
      white-space:nowrap;
    }
    .check{
      width:16px; height:16px;
      accent-color: var(--gold);
      cursor:pointer;
    }

    .field textarea{
      width:100%;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);
      color:var(--text);
      outline:none;
      font-weight:850;
      resize: vertical;
      min-height: 120px;
      font-size:12px;
      line-height:1.25;
    }
    .field textarea:focus{
      border-color: rgba(216,162,58,.45);
      box-shadow: 0 0 0 6px rgba(216,162,58,.12);
    }

    .mini{
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
      white-space:pre-wrap;
      word-break:break-word;
      background:rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.12);
      border-radius:14px;
      padding:10px;
    }

    /* Profili piccoli */
    .profiles{
      display:grid;
      grid-template-columns: 1fr;
      gap:7px;
      margin-top:8px;
    }
    .profileRow{
      display:flex;
      gap:8px;
      align-items:center;
      padding:7px 8px;
      border:1px solid rgba(255,255,255,.12);
      border-radius:12px;
      background:rgba(0,0,0,.14);
    }
    .profileMeta{
      display:flex;
      align-items:center;
      gap:8px;
      min-width:0;
      flex:1;
    }
    .profileMeta b{
      font-size:11px;
      font-weight:950;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .nextBadge{
      font-size:9px;
      font-weight:1000;
      padding:3px 7px;
      border-radius:999px;
      border:1px solid rgba(255,45,45,.55);
      color: rgba(255,235,235,.95);
      background: rgba(255,45,45,.18);
      white-space:nowrap;
      display:none;
      pointer-events:none;
      user-select:none;
    }
    .nextBadge.show{ display:inline-flex; }

    #recLamp{
      position:absolute; top:12px; right:12px;
      padding:7px 9px; border-radius:12px;
      background:rgba(0,0,0,.40);
      border:1px solid rgba(255,255,255,.18);
      font-weight:950; font-size:11px;
      display:none; align-items:center; gap:8px;
      backdrop-filter: blur(6px);
      z-index: 6;
    }

    .bottomBar{
      position: fixed;
      left: 0; right: 0; bottom: 0;
      padding: 10px 12px;
      background: rgba(0,0,0,.35);
      border-top: 1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(8px);
      display:flex;
      justify-content:flex-end;
      z-index: 50;
      gap:8px;
      flex-wrap:wrap;
    }

    /* Prompt accordion */
    details{
      border:1px solid rgba(255,255,255,.10);
      border-radius:14px;
      background: rgba(0,0,0,.14);
      padding:10px;
    }
    summary{
      cursor:pointer;
      list-style:none;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      user-select:none;
      font-weight:950;
      color: var(--text);
      font-size:11px;
    }
    summary::-webkit-details-marker{ display:none; }
    .subtle{
      font-size:11px;
      color: var(--muted);
      line-height:1.35;
      margin-top:6px;
    }
    .codeRow{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:10px;
    }
    .codeRow input{
      flex:1;
      min-width: 160px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.18);
      color:var(--text);
      outline:none;
      font-weight:900;
      font-size:12px;
    }
    .codeRow input:focus{
      border-color: rgba(216,162,58,.45);
      box-shadow: 0 0 0 6px rgba(216,162,58,.12);
    }

    /* Right-align helpers for REC */
    .ctrlLeft{ display:flex; gap:8px; align-items:center; }
    .ctrlMid{ display:flex; gap:8px; align-items:center; justify-content:center; }
    .ctrlRight{ display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-left:auto; }

    /* ============================================
       MODAL ISTRUZIONI (From Code A)
    ============================================ */
    .modalBackdrop{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 14px;
    }
    .modalBackdrop.show{ display:flex; }

    .modalCard{
      width: min(920px, 96vw);
      max-height: min(82vh, 760px);
      overflow: auto;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 18px;
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
    }
    .modalHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 12px 12px 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      position: sticky;
      top: 0;
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(8px);
      z-index: 2;
    }
    .modalHeader .title{
      font-weight: 1000;
      letter-spacing:.2px;
      font-size: 12px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .modalBody{
      padding: 12px;
      color: rgba(243,244,246,.95);
      font-size: 12px;
      line-height: 1.35;
    }
    .modalBody h3{
      margin: 12px 0 6px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing:.8px;
      color: var(--muted);
    }
    .modalBody ol, .modalBody ul{
      margin: 8px 0 10px 18px;
      padding: 0;
    }
    .modalBody li{ margin: 6px 0; }
    .callout{
      border: 1px solid rgba(216,162,58,.25);
      background: rgba(216,162,58,.10);
      border-radius: 14px;
      padding: 10px 12px;
      margin: 10px 0;
      color: rgba(243,244,246,.96);
    }
    .kbd{
      font-family: var(--mono);
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color: rgba(243,244,246,.92);
      white-space: nowrap;
    }

    /* ============================================
       DASHBOARD SPECIFIC (From Code B)
    ============================================ */
    /* KPI Grid */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .kpi-box {
      background: rgba(11, 17, 32, 0.6);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      text-align: center;
    }

    .kpi-value {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--gold);
      font-family: var(--mono);
      margin: 10px 0;
    }

    .kpi-label {
      font-size: 0.9rem;
      color: var(--muted);
    }

    /* Form Elements */
    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--muted);
      font-size: 0.9rem;
      font-weight: 600;
    }

    .input-group input,
    .input-group select,
    .input-group textarea {
      width: 100%;
      padding: 14px 18px;
      background: rgba(11, 17, 32, 0.6);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      font-family: var(--sans);
      font-size: 1rem;
      transition: all 0.3s;
    }

    .input-group input:focus,
    .input-group select:focus,
    .input-group textarea:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 3px rgba(216, 162, 58, 0.1);
    }

    /* Checklist */
    .checklist {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .checklist-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 15px;
      background: rgba(11, 17, 32, 0.6);
      border: 1px solid var(--border);
      border-radius: calc(var(--radius) - 4px);
    }

    .checklist-item input[type="checkbox"] {
      margin-top: 3px;
      width: 20px;
      height: 20px;
      accent-color: var(--gold);
    }

    .checklist-item-content {
      flex: 1;
    }

    .checklist-item-title {
      font-weight: 600;
      margin-bottom: 5px;
      color: var(--text);
    }

    .checklist-item-desc {
      font-size: 0.9rem;
      color: var(--muted);
    }

    /* Status Badges */
    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .status-active {
      background: rgba(39, 174, 96, 0.2);
      color: #27ae60;
      border: 1px solid rgba(39, 174, 96, 0.3);
    }

    .status-pending {
      background: rgba(243, 156, 18, 0.2);
      color: #f39c12;
      border: 1px solid rgba(243, 156, 18, 0.3);
    }

    .status-off {
      background: rgba(231, 76, 60, 0.2);
      color: #e74c3c;
      border: 1px solid rgba(231, 76, 60, 0.3);
    }

    /* Log Container */
    .log-container {
      background: rgba(11, 17, 32, 0.6);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      max-height: 300px;
      overflow-y: auto;
      font-family: var(--mono);
      font-size: 0.9rem;
      white-space: pre-wrap;
      line-height: 1.4;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 40px 0;
      color: var(--muted);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      margin-top: 60px;
    }

    .trust-badges {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .trust-badge {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.9rem;
    }

    .trust-badge i {
      color: var(--gold);
      font-size: 1.2rem;
    }

    /* ============================================
       RESPONSIVE (Combined)
    ============================================ */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        text-align: center;
      }
      
      .hero h2 {
        font-size: 2rem;
      }
      
      .tab-btn {
        min-width: 100%;
      }
      
      .kpi-grid {
        grid-template-columns: 1fr;
      }
      
      .whatsapp-cta {
        bottom: 20px;
        right: 20px;
      }
      
      .whatsapp-btn {
        padding: 14px 20px;
        font-size: 1rem;
      }
    }
  </style>
</head>

<body>
  <!-- WhatsApp Floating Button -->
  <div class="whatsapp-cta">
    <a href="https://wa.me/393713708294" class="whatsapp-btn" target="_blank" aria-label="Contattami su WhatsApp">
      <i class="fab fa-whatsapp"></i>
      <span>Ottieni Slot</span>
    </a>
  </div>

  <!-- HEADER -->
  <header class="header">
    <div class="wrap">
      <div class="header-content">
        <div class="logo">
          <div class="logo-badge">MW</div>
          <div class="logo-text">
            <h1>SYSTEM ACQ PRO</h1>
            <div class="subtitle">Sistema Operativo Immobiliare + Video Creator</div>
          </div>
        </div>
        <div class="status-pills">
          <span class="pill highlight">Agente Immobiliare</span>
          <span class="pill highlight">Digital Strategist</span>
          <span class="pill">Video Creator Pro</span>
          <span class="pill">Modalit√†: Operativa</span>
        </div>
      </div>
    </div>
  </header>

  <!-- HERO SECTION -->
  <main class="wrap">
    <section class="hero">
      <h2>Sistema Operativo Completo: Acquisizione + Video</h2>
      <p>Unisci l'acquisizione immobiliare territoriale con la produzione video professionale in un unico sistema integrato.</p>
      
      <!-- Scarcity Banner -->
      <div class="scarcity-banner">
        <h3><i class="fas fa-exclamation-circle"></i> POSTI LIMITATI QUESTA SETTIMANA</h3>
        <div class="slot-counter">3</div>
        <p>Slot rimasti per consulenze gratuite di implementazione</p>
        <p class="scarcity-note">Disponibilit√† aggiornata manualmente - Contatta subito per riservare</p>
      </div>
    </section>

    <!-- TABS SYSTEM -->
    <div class="tabs-container">
      <div class="tabs-header">
        <button class="tab-btn active" data-tab="video">Video Creator</button>
        <button class="tab-btn" data-tab="oggi">Oggi (Operativo)</button>
        <button class="tab-btn" data-tab="settimana">Piano Settimanale</button>
        <button class="tab-btn" data-tab="digitale">Strategia Digitale</button>
        <button class="tab-btn" data-tab="diagnosi">Diagnosi & Report</button>
        <button class="tab-btn" data-tab="analisi">Analisi Mercato</button>
      </div>

      <!-- TAB 1: VIDEO CREATOR (CODICE A) -->
      <div class="tab-content active" id="tab-video">
        <!-- Video Creator Content (Full Code A) -->
        <div class="wrap">
          <!-- TOP ROW -->
          <header>
            <div class="row" style="flex:1;">
              <button class="btn primary" id="btnNext" type="button">
                <span class="ico">‚ú®</span> Nuova domanda
              </button>

              <button class="btn blue" id="btnOpenChatGPTPasteQ" type="button" title="Copia PROMPT + domanda e apre ChatGPT">
                <span class="ico">üí¨</span> Apri ChatGPT + copia domanda
              </button>

              <button class="btn violet" id="btnPasteTop" type="button" title="Incolla dagli appunti nel blocco risposta qui sotto">
                <span class="ico">üìã</span> Incolla risposta
              </button>

              <button class="btn gray" id="btnInstructions" type="button" title="Apri guida operativa">
                <span class="ico">üìò</span> Istruzioni
              </button>

              <span class="pill">
                <span id="videoCounter">Video: 0</span>
                <span>‚Ä¢</span>
                <span id="activeProfileLabel">Prossimo: ‚Äî</span>
              </span>
            </div>

            <div class="row">
              <button class="btn tiny gray" id="btnBackTop" type="button">‚Üê Sistema Principale</button>
            </div>
          </header>

          <!-- Didascalia breve -->
          <div class="hintTop">
            1) <b>Nuova domanda</b> ‚Üí 2) <b>Apri ChatGPT + copia domanda</b> (incolla e invia) ‚Üí 3) usa <b>copia</b> su ChatGPT ‚Üí
            4) <b>Incolla risposta</b> ‚Üí 5) <b>Teleprompter + REC</b>
          </div>

          <!-- BLOCCO RISPOSTA IN ALTO (vuoto di default) -->
          <div class="card">
            <div class="section">
              <p class="h">Risposta (da ChatGPT o scritta da te)</p>
              <div class="field">
                <textarea id="answerBox" placeholder="Qui verr√† incollata la risposta quando premi "Incolla risposta"..."></textarea>
              </div>

              <div class="bar left" style="margin-top:10px;">
                <button class="btn primary" id="btnSendTele" type="button"><span class="ico">‚û°Ô∏è</span> Invia al teleprompter</button>
                <button class="btn gray" id="btnCopyCaption" type="button" title="Copia caption con hashtag (se non gi√† presenti)">
                  <span class="ico">üìã</span> Copia caption
                </button>
              </div>

              <div class="subtle">
                "Invia al teleprompter" ti permette anche di inserire messaggi scritti da te (non solo incollati da ChatGPT).
              </div>
            </div>
          </div>

          <div class="layout">
            <!-- MAIN -->
            <div class="card">
              <div class="section">
                <p class="h">Video 9:16 + teleprompter</p>

                <div class="stageRow">
                  <div class="stageBlock">
                    <div id="stage916">
                      <video id="cam" autoplay playsinline muted></video>

                      <div id="recLamp">
                        <span style="width:10px;height:10px;border-radius:999px;background:#ff2d2d;display:inline-block;"></span>
                        <span id="recTime">REC 00:00</span>
                      </div>

                      <div id="overlay">
                        <div id="questionBoxOverlay">Premi "Nuova domanda".</div>
                        <div id="teleprompterOverlay">
                          <div id="teleText">Incolla/scrivi una risposta in alto ‚Üí "Invia al teleprompter" ‚Üí "Teleprompter + REC".</div>
                        </div>
                      </div>
                    </div>

                    <div class="controlsRow">
                      <!-- REC pi√π a destra: layout a 3 blocchi -->
                      <div class="bar between" style="width:100%;">
                        <div class="ctrlLeft">
                          <button class="btn gray" id="btnCam" type="button"><span class="ico">üì∑</span> Camera</button>
                        </div>

                        <div class="ctrlMid">
                          <button class="btn gray" id="btnStop" type="button"><span class="ico">‚èπ</span> Stop</button>
                          <button class="btn gray" id="btnRestart" type="button"><span class="ico">‚Üª</span> Riavvia</button>
                        </div>

                        <div class="ctrlRight">
                          <button class="btn rec" id="btnTeleRec" type="button" title="Avvia teleprompter e registrazione">
                            <span class="dot"></span> Teleprompter + REC
                          </button>
                        </div>
                      </div>

                      <div class="bar">
                        <label class="chk"><input class="check" type="checkbox" id="speed120"> 120</label>
                        <label class="chk"><input class="check" type="checkbox" id="speed105"> 105</label>
                        <label class="chk"><input class="check" type="checkbox" id="speed90"> 90</label>
                        <span class="pill" id="speedLabel">Vel: 105s</span>
                      </div>

                      <div class="sliderRow">
                        <span>Zoom</span>
                        <input id="zoom" type="range" min="1" max="2.5" step="0.1" value="1" />
                        <span id="zoomVal">1.0x</span>
                      </div>
                    </div>
                  </div>

                  <div>
                    <p class="h">Rotazione profili (piccola)</p>
                    <div class="profiles">
                      <div class="profileRow">
                        <input class="check" type="checkbox" id="rot_tiktok" checked>
                        <div class="profileMeta"><b>üì± TikTok</b></div>
                        <span class="nextBadge" id="badge_tiktok">PROSSIMO</span>
                      </div>
                      <div class="profileRow">
                        <input class="check" type="checkbox" id="rot_instagram" checked>
                        <div class="profileMeta"><b>üì∏ Instagram</b></div>
                        <span class="nextBadge" id="badge_instagram">PROSSIMO</span>
                      </div>
                      <div class="profileRow">
                        <input class="check" type="checkbox" id="rot_shorts">
                        <div class="profileMeta"><b>üé• Shorts</b></div>
                        <span class="nextBadge" id="badge_shorts">PROSSIMO</span>
                      </div>
                      <div class="profileRow">
                        <input class="check" type="checkbox" id="rot_facebook">
                        <div class="profileMeta"><b>üíº Facebook</b></div>
                        <span class="nextBadge" id="badge_facebook">PROSSIMO</span>
                      </div>
                    </div>

                    <div class="subtle">
                      Seleziona i canali da includere. "PROSSIMO" √® solo un indicatore (non cliccabile).
                    </div>
                  </div>
                </div>

                <canvas id="recCanvas" width="1080" height="1920" style="display:none;"></canvas>
              </div>
            </div>

            <!-- SIDE -->
            <div class="card">
              <div class="section">
                <div class="bar between">
                  <p class="h" style="margin:0;">Caption (memorizzata)</p>
                  <label class="chk" title="Memorizza la caption (senza hashtag) per il prossimo avvio">
                    <input type="checkbox" id="chkRememberCaption" class="check" checked />
                    Memorizza
                  </label>
                </div>

                <div class="mini" id="captionPreview" style="margin-top:10px;">‚Äî</div>
                <div class="subtle">Gli hashtag automatici vengono aggiunti solo in copia (se non gi√† presenti).</div>
              </div>

              <div class="section">
                <p class="h">Video creati</p>
                <div class="subtle">Seleziona un elemento (qui sotto) per rivederlo.</div>

                <video id="playback" controls style="width:100%; border-radius:14px; background:#000; margin-top:10px;"></video>

                <div class="bar left" style="margin-top:10px;">
                  <button class="btn" id="btnDownloadVideo" type="button"><span class="ico">üì•</span> Scarica video</button>

                  <input id="videoUpload" type="file" accept="video/*" style="display:none;" />
                  <button class="btn" id="btnUploadVideo" type="button" title="Carica un video e aggiungilo alla lista">
                    <span class="ico">‚¨ÜÔ∏è</span> Carica video
                  </button>

                  <button class="btn tiny gray" id="btnClearList" type="button">üóëÔ∏è Svuota</button>
                </div>

                <div class="mini" id="recList" style="margin-top:10px; max-height:260px; overflow:auto;">‚Äî</div>
              </div>

              <!-- PROMPT BLOCCO A FONDO PAGINA -->
              <div class="section">
                <details id="promptDetails">
                  <summary>
                    <span>üß† Prompt ChatGPT (clicca per aprire)</span>
                    <span class="pill" id="promptStatePill">Bloccato</span>
                  </summary>

                  <div class="subtle">
                    Questo prompt viene sempre inserito <b>prima</b> della domanda quando premi "Apri ChatGPT + copia domanda".
                  </div>

                  <div class="field" style="margin-top:10px;">
                    <textarea id="promptBox" readonly></textarea>
                  </div>

                  <div class="codeRow">
                    <input id="unlockCode" placeholder="Codice per modificare il prompt" />
                    <button class="btn tiny primary" id="btnUnlock" type="button">Sblocca</button>
                    <button class="btn tiny" id="btnSavePrompt" type="button" disabled>Salva</button>
                    <button class="btn tiny" id="btnResetPrompt" type="button" disabled>Ripristina</button>
                  </div>

                  <div class="subtle">Per modificare serve il codice: <b>16091979Jm</b>.</div>
                </details>
              </div>
            </div>
          </div>
        </div>

        <!-- Bottom bar -->
        <div class="bottomBar">
          <button class="btn tiny gray" id="btnBackBottom" type="button">‚Üê Sistema Principale</button>
          <button class="btn tiny gray" id="btnInstructionsBottom" type="button"><span class="ico">üìò</span> Istruzioni</button>
        </div>

        <!-- ==========================
             MODAL ISTRUZIONI
        ========================== -->
        <div class="modalBackdrop" id="instructionsModal" aria-hidden="true">
          <div class="modalCard" role="dialog" aria-modal="true" aria-labelledby="instrTitle">
            <div class="modalHeader">
              <div class="title" id="instrTitle">üìò Istruzioni operative ‚Äì Video Creator</div>
              <button class="btn tiny gray" id="btnCloseInstructions" type="button">‚úï Chiudi</button>
            </div>

            <div class="modalBody">
              <div class="callout">
                Obiettivo: creare video verticali <b>9:16</b> in serie (TikTok/Instagram/Shorts/Facebook) con <b>domanda ‚Üí risposta ‚Üí teleprompter ‚Üí REC ‚Üí caption ‚Üí download</b>.
              </div>

              <h3>Flusso standard</h3>
              <ol>
                <li><b>Nuova domanda</b> ‚Üí clicca <span class="kbd">‚ú® Nuova domanda</span> e leggi la domanda che appare sul video.</li>
                <li><b>Risposta da ChatGPT</b> ‚Üí clicca <span class="kbd">üí¨ Apri ChatGPT + copia domanda</span>, incolla in ChatGPT e invia. Poi copia la risposta completa.</li>
                <li><b>Incolla risposta</b> ‚Üí torna qui e clicca <span class="kbd">üìã Incolla risposta</span> (finisce nel box "Risposta").</li>
                <li><b>Invia al teleprompter</b> ‚Üí clicca <span class="kbd">‚û°Ô∏è Invia al teleprompter</span> (il testo va nel teleprompter e diventa anche caption base).</li>
                <li><b>Prepara</b> ‚Üí se serve clicca <span class="kbd">üì∑ Camera</span>, scegli velocit√† (90/105/120) e regola zoom.</li>
                <li><b>Registra</b> ‚Üí clicca <span class="kbd">üî¥ Teleprompter + REC</span>. Quando finisci clicca <span class="kbd">‚èπ Stop</span>.</li>
                <li><b>Rivedi/Scarica</b> ‚Üí seleziona il video in "Video creati" e clicca <span class="kbd">üì• Scarica video</span>.</li>
                <li><b>Caption</b> ‚Üí clicca <span class="kbd">üìã Copia caption</span> (aggiunge hashtag automatici se mancanti).</li>
              </ol>

              <h3>Produzione in serie</h3>
              <ul>
                <li>Ripeti sempre: <b>Nuova domanda ‚Üí ChatGPT ‚Üí Incolla ‚Üí Invia al teleprompter ‚Üí REC ‚Üí Stop</b>.</li>
                <li>La "rotazione profili" sposta automaticamente il <b>prossimo canale</b> dopo ogni registrazione.</li>
              </ul>

              <h3>Upload video</h3>
              <ul>
                <li>Puoi aggiungere un video manualmente con <span class="kbd">‚¨ÜÔ∏è Carica video</span>: entra in lista, si pu√≤ rivedere e scaricare.</li>
                <li>Il video caricato resta disponibile finch√© la pagina √® aperta (workflow perfetto per test e revisione).</li>
              </ul>

              <div class="subtle">
                Tip: premi <span class="kbd">ESC</span> per chiudere questa finestra.
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB 2: OGGI (OPERATIVO) - From Code B -->
      <div class="tab-content" id="tab-oggi">
        <div class="card">
          <h3>Stato Operativo Giornaliero</h3>
          <div class="input-group">
            <label>Data</label>
            <input type="date" id="todayDate">
          </div>
          <div class="input-group">
            <label>Micro-zona di oggi (1 sola, da piano)</label>
            <input type="text" id="todayZone" placeholder='Es: "Via Roma 10-30"'>
          </div>
          
          <div class="kpi-grid">
            <div class="kpi-box">
              <div class="kpi-label">Persone Parlate (target: ‚â•20)</div>
              <div class="kpi-value" id="kpiPeople">0</div>
              <div class="btn-group" style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn btn-secondary" onclick="adjustCounter('people', -1)">-1</button>
                <button class="btn btn-primary" onclick="adjustCounter('people', 1)">+1</button>
              </div>
            </div>
            <div class="kpi-box">
              <div class="kpi-label">Nominativi Raccolti (target: ‚â•1)</div>
              <div class="kpi-value" id="kpiNominatives">0</div>
              <div class="btn-group" style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn btn-secondary" onclick="adjustCounter('nominatives', -1)">-1</button>
                <button class="btn btn-primary" onclick="adjustCounter('nominatives', 1)">+1</button>
              </div>
            </div>
            <div class="kpi-box">
              <div class="kpi-label">Appuntamenti Fissati (target: ‚â•1)</div>
              <div class="kpi-value" id="kpiAppointments">0</div>
              <div class="btn-group" style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn btn-secondary" onclick="adjustCounter('appointments', -1)">-1</button>
                <button class="btn btn-primary" onclick="adjustCounter('appointments', 1)">+1</button>
              </div>
            </div>
            <div class="kpi-box">
              <div class="kpi-label">Incarichi Firmati</div>
              <div class="kpi-value" id="kpiAssignments">0</div>
              <div class="btn-group" style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn btn-secondary" onclick="adjustCounter('assignments', -1)">-1</button>
                <button class="btn btn-success" onclick="adjustCounter('assignments', 1)">+1</button>
              </div>
            </div>
          </div>
          
          <div style="text-align: center; margin: 20px 0;">
            <button class="btn btn-primary" onclick="saveDailyState()">
              <i class="fas fa-save"></i> Salva Stato Giornata
            </button>
            <button class="btn btn-secondary" onclick="resetDaily()">
              <i class="fas fa-redo"></i> Reset Giornata
            </button>
          </div>
        </div>

        <div class="card">
          <h3>Checklist Operativa (Esecuzione Cieca)</h3>
          <div class="checklist" id="dailyChecklist">
            <!-- Popolato da JavaScript -->
          </div>
        </div>

        <div class="card">
          <h3>Script Operativi (NON MODIFICARE)</h3>
          <div class="input-group">
            <label>Frase Contatto Unica</label>
            <textarea readonly rows="2">"Buongiorno, lavoro qui in zona. Lei o qualcuno che conosce sta pensando di vendere casa?"</textarea>
          </div>
          <div class="input-group">
            <label>3 Domande Qualifica (ordine fisso)</label>
            <textarea readonly rows="4">1) "Sta pensando DAVVERO di vendere?"
2) "Entro quando?"
3) "Ha gi√† parlato con altri professionisti?"</textarea>
          </div>
        </div>
      </div>

      <!-- TAB 3: PIANO SETTIMANALE - From Code B -->
      <div class="tab-content" id="tab-settimana">
        <div class="card">
          <h3>Piano Settimanale Micro-Zone</h3>
          <p style="color: var(--muted); margin-bottom: 20px;">La zona non cambia finch√© non hai saturato numeri minimi (‚â•100 persone / ‚â•8 appuntamenti / ‚â•2 incarichi)</p>
          
          <div class="input-group">
            <label>Settimana (etichetta)</label>
            <input type="text" id="weekLabel" placeholder="Es: Settimana 1 - Gennaio">
          </div>
          
          <div class="input-group">
            <label>Micro-zona dominante (5 giorni minimo)</label>
            <input type="text" id="dominantZone" placeholder='Es: "Via Roma 1-50 (condomini anni 70)"'>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
            <div class="input-group">
              <label>Luned√¨</label>
              <input type="text" id="dayMon" placeholder="Zona giorno">
            </div>
            <div class="input-group">
              <label>Marted√¨</label>
              <input type="text" id="dayTue" placeholder="Zona giorno">
            </div>
            <div class="input-group">
              <label>Mercoled√¨</label>
              <input type="text" id="dayWed" placeholder="Zona giorno">
            </div>
            <div class="input-group">
              <label>Gioved√¨</label>
              <input type="text" id="dayThu" placeholder="Zona giorno">
            </div>
            <div class="input-group">
              <label>Venerd√¨</label>
              <input type="text" id="dayFri" placeholder="Zona giorno">
            </div>
          </div>
          
          <div style="text-align: center;">
            <button class="btn btn-primary" onclick="saveWeekPlan()">
              <i class="fas fa-save"></i> Salva Piano Settimanale
            </button>
            <button class="btn btn-secondary" onclick="applyDominantToAll()">
              <i class="fas fa-copy"></i> Applica a Tutti i Giorni
            </button>
          </div>
        </div>
      </div>

      <!-- TAB 4: DIGITALE - From Code B -->
      <div class="tab-content" id="tab-digitale">
        <div class="card">
          <h3>Strategia Digitale - Trasforma Territorio in Contenuti</h3>
          
          <div class="scarcity-banner" style="background: rgba(37, 211, 102, 0.1); border-color: #25D366;">
            <h3><i class="fas fa-bolt"></i> CONTENUTI POLARIZZANTI</h3>
            <p>Massimizza commenti e conversazioni - Inserisciti nelle conversazioni gi√† esistenti</p>
            <p class="scarcity-note">Regola base: SE NON GENERA CONVERSAZIONE ‚Üí VA CAMBIATO</p>
          </div>
          
          <div class="input-group">
            <label>CTA Unica Digitale</label>
            <input type="text" id="ctaDigital" value="VALORE">
          </div>
          
          <div class="input-group">
            <label>Piattaforme</label>
            <select id="platforms" multiple style="height: 120px;">
              <option selected>Facebook (Gruppi Locali)</option>
              <option selected>Instagram (Reels)</option>
              <option selected>TikTok (Shorts)</option>
              <option selected>YouTube (Shorts + Long)</option>
              <option selected>LinkedIn (Post Professionali)</option>
            </select>
            <small style="color: var(--muted);">Tieni premuto Ctrl per selezionare pi√π opzioni</small>
          </div>
          
          <div style="text-align: center; margin: 20px 0;">
            <button class="btn btn-primary" onclick="generateContentPlan()">
              <i class="fas fa-magic"></i> Genera Piano Contenuti (14 giorni)
            </button>
            <a href="https://wa.me/393713708294" class="btn btn-success" target="_blank">
              <i class="fab fa-whatsapp"></i> Consulenza Strategia Digitale
            </a>
          </div>
        </div>
      </div>

      <!-- TAB 5: DIAGNOSI - From Code B -->
      <div class="tab-content" id="tab-diagnosi">
        <div class="card">
          <h3>Diagnosi Automatica - Codici Errore</h3>
          
          <div class="kpi-grid">
            <div class="kpi-box">
              <div class="kpi-label">Status Sistema</div>
              <div id="systemStatus" class="status-badge status-active">ATTIVO</div>
            </div>
            <div class="kpi-box">
              <div class="kpi-label">Ultima Diagnosi</div>
              <div id="lastDiagnosis" style="color: var(--gold);">‚Äî</div>
            </div>
          </div>
          
          <div class="input-group">
            <label>Log Diagnosi</label>
            <div class="log-container" id="diagnosisLog">
              Avvia la diagnosi per vedere i dettagli
            </div>
          </div>
          
          <div style="text-align: center; margin: 20px 0;">
            <button class="btn btn-primary" onclick="runDiagnostics()">
              <i class="fas fa-stethoscope"></i> Esegui Diagnosi Completa
            </button>
            <button class="btn btn-secondary" onclick="generateDailyReport()">
              <i class="fas fa-file-pdf"></i> Genera Report Giornaliero
            </button>
          </div>
        </div>
      </div>

      <!-- TAB 6: ANALISI - From Code B -->
      <div class="tab-content" id="tab-analisi">
        <div class="card">
          <h3>Analisi Mercato - Provincia di Torino</h3>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
            <div class="kpi-box">
              <div class="kpi-label">Comuni Totali</div>
              <div class="kpi-value">312</div>
            </div>
            <div class="kpi-box">
              <div class="kpi-label">Zone Omogenee</div>
              <div class="kpi-value">11</div>
            </div>
            <div class="kpi-box">
              <div class="kpi-label">Prezzo Medio Provincia</div>
              <div class="kpi-value">‚Ç¨2.800/m¬≤</div>
            </div>
          </div>
          
          <div class="input-group">
            <label>Zona di Interesse</label>
            <select id="analysisZone">
              <option value="condove">Condove (Val Susa)</option>
              <option value="torino">Torino Centro</option>
              <option value="corona_nord">Corona Nord</option>
              <option value="canavese">Canavese</option>
              <option value="valli">Valli Susa e Sangone</option>
            </select>
          </div>
          
          <div style="text-align: center; margin: 20px 0;">
            <a href="https://wa.me/393713708294?text=Ciao,%20vorrei%20un'analisi%20dettagliata%20del%20mercato%20immobiliare%20nella%20mia%20zona" 
               class="btn btn-primary" target="_blank">
              <i class="fas fa-chart-line"></i> Richiedi Analisi Personalizzata
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- TRUST BADGES -->
  <div class="card" style="text-align: center; margin: 40px auto; max-width: 800px;">
    <h3>Perch√© Scegliere Questo Sistema</h3>
    <div class="trust-badges">
      <div class="trust-badge">
        <i class="fas fa-check-circle"></i>
        <span>Risposta WhatsApp entro 24h</span>
      </div>
      <div class="trust-badge">
        <i class="fas fa-shield-alt"></i>
        <span>Sistema Testato sul Campo</span>
      </div>
      <div class="trust-badge">
        <i class="fas fa-chart-line"></i>
        <span>+400% Vendite in 3 Mesi</span>
      </div>
      <div class="trust-badge">
        <i class="fas fa-user-tie"></i>
        <span>Consulenza 1-on-1 Inclusa</span>
      </div>
    </div>
  </div>

  <!-- FINAL CTA -->
  <div style="text-align: center; margin: 60px 0 40px;">
    <div class="scarcity-banner" style="max-width: 700px;">
      <h3><i class="fas fa-clock"></i> OFFERTA A TEMPO LIMITATO</h3>
      <p>Solo <strong>3 slot</strong> disponibili per l'implementazione completa del sistema</p>
      <p>Incluso: Setup + Training + 30 giorni di supporto</p>
      
      <a href="https://wa.me/393713708294?text=Ciao,%20sono%20interessato%20al%20sistema%20operativo%20immobiliare%20e%20video.%20√à%20ancora%20disponibile%20uno%20slot?" 
         class="whatsapp-btn" style="margin: 20px auto; display: inline-flex;" target="_blank">
        <i class="fab fa-whatsapp"></i>
        <span>PRENOTA ORA - SLOT LIMITATI</span>
      </a>
      
      <p class="scarcity-note">Ultima possibilit√† per il 2024 - Prezzi raddoppiano a Gennaio</p>
    </div>
  </div>
</main>

<!-- FOOTER -->
<footer class="footer">
  <div class="wrap">
    <p>¬© 2024 SYSTEM ACQ PRO - Sistema Operativo Immobiliare + Video Creator</p>
    <p style="font-size: 0.8rem; color: var(--muted); margin-top: 10px;">
      Sistema integrato per agenti immobiliari seri che vogliono dominare territorio e produzione video.
      Non garantiamo risultati, garantiamo metodo.
    </p>
    <div style="margin-top: 20px;">
      <a href="https://wa.me/393713708294" style="color: var(--gold); text-decoration: none;" target="_blank">
        <i class="fab fa-whatsapp"></i> Contatto Ufficiale: +39 371 3708294
      </a>
    </div>
  </div>
</footer>

<script>
/* ============================================
   GLOBAL CONFIGURATION & STATE MANAGEMENT
============================================ */

// Sistema di Storage unificato
const storageKeys = {
  // Video Creator (from Code A)
  vc_prompt_text: 'vc_prompt_text',
  vc_caption_clean: 'vc_caption_clean',
  
  // Dashboard (from Code B)
  system_acq_today: 'system_acq_today',
  system_acq_week: 'system_acq_week',
  system_acq_counters: 'system_acq_counters',
  system_acq_checklist: 'system_acq_checklist',
  system_acq_logs: 'system_acq_logs'
};

// ============================================
// VIDEO CREATOR CODE (CODICE A - COMPLETE)
// ============================================

// Config
const GESTIONALE_URL = "index.html"; // Auto-referenzia per tornare al sistema
const CHATGPT_URL = "https://chatgpt.com/c/6952922f-1ab4-8326-b3bb-28536c3bfab0";

/* Hashtag automatici (NON mostrati in preview) */
const HIDDEN_HASHTAGS = [
  "#immobiliarelasacra","#josephcretorlab","#realmediapro","#amamy","#immobiliare","#realestateitalia",
  "#mercatoimmobiliare","#agenziaimmobiliare","#casainvendita","#venditacasa","#investimentiimmobiliari",
  "#property","#realestate","#digitalstrategist","#digitalstrategy","#marketingdigitale","#strategiamarketing",
  "#brandstrategy","#contentstrategy","#socialmediastrategy","#growthmarketing","#personalbranding","#branding",
  "#businessdigitale","#marketingonline"
].join(" ");

/* Prompt base (nuovo) */
const BASE_PROMPT = `üß© PROMPT ADATTIVO ‚Äì VERSIONE FINALE (250 PAROLE + HASHTAG)

Agisci come un consulente immobiliare esperto, con uno stile friendly, chiaro e professionale, adatto anche a un ragazzo di 15 anni.

Rispondi alle domande che ti fornir√≤ con testi di massimo 250 parole, semplici, scorrevoli e concreti.

Adatta progressivamente il tuo stile sulla base delle domande precedenti e delle risposte gi√† fornite, migliorando chiarezza, precisione ed efficacia comunicativa nel tempo.

Usa un linguaggio:

semplice e diretto

privo di tecnicismi inutili

arricchito da esempi pratici della vita quotidiana

Se utilizzi un termine tecnico, spiegalo immediatamente in modo semplice.

Mantieni sempre un tono amichevole, rassicurante e professionale, mai infantile e mai burocratico.

Struttura ogni risposta in questo modo:

problema che andiamo a risolvere Breve introduzione che inquadra l'argomento

Spiegazione chiara, con esempi concreti

Conclusione, con un consiglio pratico

Al termine di ogni risposta, aggiungi una breve lista di hashtag pertinenti al tema trattato (5), e #immobiliarelasacra #josephcretorlab #realmediapro #amamy #immobiliare #realestateitalia #mercatoimmobiliare #agenziaimmobiliare #casainvendita #venditacasa #investimentiimmobiliari #property #realestate #digitalstrategist #digitalstrategy #marketingdigitale #strategiamarketing #brandstrategy #contentstrategy #socialmediastrategy #growthmarketing #personalbranding #branding #businessdigitale #marketingonline

Regole fondamentali:

Lunghezza massima: 250 parole non di piu'

Niente linguaggio tecnico inutile`;

/* Codice sblocco prompt */
const UNLOCK_CODE = "16091979Jm";

/* Archivio domande */
const QUESTION_BANK = [
  { q:"Perch√© ricevo poche chiamate anche se l'annuncio √® online da settimane?" },
  { q:"Se arrivano solo curiosi e nessuna proposta, cosa significa?" },
  { q:"Come capisco se il prezzo sta bloccando la vendita?" },
  { q:"Meglio partire alto e poi scendere o partire subito con il prezzo giusto?" },
  { q:"Ha senso provare a vendere da privato oppure rischio solo di perdere tempo?" },
  { q:"Se un agente mi chiede l'esclusiva, come capisco se conviene davvero?" },
  { q:"Quali sono le fasi reali di una vendita fatta bene, dall'inizio alla firma?" },
  { q:"Cosa devo controllare settimana per settimana per capire se la vendita sta andando bene?" },
  { q:"Se dopo le visite non succede nulla, qual √® la sequenza corretta per intervenire?" },
];

/* Teleprompter speed */
const TELE_SPEEDS = { s120:120, s105:105, s90:90 };
let teleprompterSeconds = TELE_SPEEDS.s105;

/* State - Video Creator */
let qIdx = -1;
let currentQuestion = "";
let lastCaptionClean = "";
let totalVideos = 0;

/* Rotazione profili */
let rotationIndex = 0;

/* Prompt state */
let promptText = "";

// ============================================
// DASHBOARD CODE (CODICE B - COMPLETE)
// ============================================

// Stato dashboard
let dashboardCounters = {
  people: 0,
  nominatives: 0,
  appointments: 0,
  assignments: 0
};

const defaultChecklist = [
  { id: 1, title: "Fase 1 (08:30-09:00) - Preparazione", desc: "Compila stato operativo, carica micro-zona dal piano", done: false },
  { id: 2, title: "Fase 2 (09:00-12:00) - Raccolta Contatti", desc: "Parla con ‚â•20 persone, frase unica, registra nominativi", done: false },
  { id: 3, title: "Fase 3 (12:00-13:00) - Qualifica & Agenda", desc: "3 domande in ordine, fissa ‚â•1 appuntamento con data/ora", done: false },
  { id: 4, title: "Fase 4 (15:00-17:00) - Appuntamento", desc: "Ordine fisso: Persona ‚Üí Motivo ‚Üí Tempo ‚Üí Casa ‚Üí Mercato ‚Üí Prezzo", done: false },
  { id: 5, title: "Fase 5 (17:00-18:00) - Follow-up", desc: "Chiudi loop aperti, elimina indecisi, mantieni pipeline pulita", done: false },
  { id: 6, title: "Fase 6 (18:00-18:30) - Analisi Dati", desc: "Scrivi SOLO numeri, diagnosi automatica, piano domani", done: false }
];

// ============================================
// SHARED UTILITIES (Both systems)
// ============================================

const $ = (id) => document.getElementById(id);

function pad2(n){ return String(n).padStart(2,"0"); }
function nowStamp(){
  const d = new Date();
  return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}-${pad2(d.getHours())}-${pad2(d.getMinutes())}-${pad2(d.getSeconds())}`;
}
function slugify(it){
  return String(it || "")
    .toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
    .replace(/[^a-z0-9\s-]/g,"")
    .trim()
    .replace(/\s+/g,"-")
    .replace(/-+/g,"-")
    .slice(0, 50);
}
function keywordsFromQuestion(q){
  const stop = new Set(["perche","perch√©","che","cosa","come","se","e","o","il","lo","la","i","gli","le","un","una","da","di","del","della","delle","dei","dello","in","su","a","al","alla","alle","agli","ai","con","senza","poi","subito","solo","nessuna","nessun","meglio","ha","senso","dopo","non","piu","pi√π","anche"]);
  const words = slugify(q).split("-").filter(w => w && !stop.has(w));
  return words.slice(0, 4).join("-");
}

async function copyText(text){
  const t = String(text || "");
  if(!t.trim()) return false;
  try{
    await navigator.clipboard.writeText(t);
    return true;
  }catch(e){
    const ta = document.createElement("textarea");
    ta.value = t;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    ta.remove();
    return true;
  }
}
async function readClipboardText(){
  return await navigator.clipboard.readText(); // HTTPS/localhost
}

/* Caption: aggiungi hashtag solo se non gi√† presenti */
function captionWithHashtagsIfNeeded(clean){
  const c = String(clean || "").trim();
  if(!c) return "";

  const lower = c.toLowerCase();
  if (lower.includes("#immobiliarelasacra") || lower.includes("#josephcretorlab") || lower.includes("#realmediapro")){
    return c;
  }
  return `${c}\n\n${HIDDEN_HASHTAGS}`.trim();
}

// ============================================
// VIDEO CREATOR FUNCTIONS (CODICE A)
// ============================================

function setCaptionClean(clean){
  lastCaptionClean = String(clean || "").trim();
  $("captionPreview").textContent = lastCaptionClean || "‚Äî";
  if ($("chkRememberCaption").checked){
    try{ localStorage.setItem(storageKeys.vc_caption_clean, lastCaptionClean); }catch(e){}
  }
}

function loadPrompt(){
  try{
    const saved = localStorage.getItem(storageKeys.vc_prompt_text);
    promptText = (saved && saved.trim()) ? saved : BASE_PROMPT;
  }catch(e){
    promptText = BASE_PROMPT;
  }
  $("promptBox").value = promptText;
}
function lockPromptUI(){
  $("promptBox").readOnly = true;
  $("btnSavePrompt").disabled = true;
  $("btnResetPrompt").disabled = true;
  $("promptStatePill").textContent = "Bloccato";
}
function unlockPromptUI(){
  $("promptBox").readOnly = false;
  $("btnSavePrompt").disabled = false;
  $("btnResetPrompt").disabled = false;
  $("promptStatePill").textContent = "Sbloccato";
}
function savePrompt(){
  promptText = $("promptBox").value || BASE_PROMPT;
  try{ localStorage.setItem(storageKeys.vc_prompt_text, promptText); }catch(e){}
}

function showQuestionInOverlay(q){
  $("questionBoxOverlay").textContent = q ? q : "Premi "Nuova domanda".";
}
function nextQuestion(){
  qIdx = (qIdx + 1) % QUESTION_BANK.length;
  currentQuestion = QUESTION_BANK[qIdx].q;
  showQuestionInOverlay(currentQuestion);
}
function composeChatGPTInput(){
  const q = String(currentQuestion || "").trim();
  if(!q) return (promptText || BASE_PROMPT).trim();
  return `${(promptText || BASE_PROMPT).trim()}\n\nInput:\nüëâ ${q}`.trim();
}

function getRotationPlatforms(){
  const items = [
    { id:"rot_tiktok", platform:"tiktok" },
    { id:"rot_instagram", platform:"instagram" },
    { id:"rot_shorts", platform:"shorts" },
    { id:"rot_facebook", platform:"facebook" },
  ];
  return items.filter(x => $(x.id).checked);
}
function setNextBadge(platform){
  const map = {
    tiktok: $("badge_tiktok"),
    instagram: $("badge_instagram"),
    shorts: $("badge_shorts"),
    facebook: $("badge_facebook"),
  };
  Object.values(map).forEach(el => el.classList.remove("show"));
  if(platform && map[platform]) map[platform].classList.add("show");
}
function getActivePlatform(){
  const list = getRotationPlatforms();
  if(list.length === 0) return null;
  rotationIndex = rotationIndex % list.length;
  return list[rotationIndex].platform;
}
function advancePlatform(){
  const list = getRotationPlatforms();
  if(list.length === 0) return;
  rotationIndex = (rotationIndex + 1) % list.length;
}
function refreshProfileUI(){
  const active = getActivePlatform();
  setNextBadge(active);
  $("activeProfileLabel").textContent = "Prossimo: " + (active ? active : "‚Äî");
}

/* TELEPROMPTER SCROLL */
let startTimeSec = null;
let isTeleprompterRunning = false;
let teleprompterAnimationId = null;

function resetTeleprompter(){
  $("teleText").style.transform = "translateY(20px)";
}
function startTeleprompter(){
  if(isTeleprompterRunning) return;
  isTeleprompterRunning = true;
  startTimeSec = performance.now() / 1000;
  animateTele();
}
function stopTeleprompter(){
  isTeleprompterRunning = false;
  if(teleprompterAnimationId) cancelAnimationFrame(teleprompterAnimationId);
  teleprompterAnimationId = null;
}
function restartTeleprompter(){
  stopTeleprompter();
  resetTeleprompter();
  setTimeout(()=> startTeleprompter(), 120);
}
function animateTele(){
  if(!isTeleprompterRunning) return;

  const teleEl = $("teleText");
  if(!teleEl){
    teleprompterAnimationId = requestAnimationFrame(animateTele);
    return;
  }

  const now = performance.now()/1000;
  const elapsed = now - startTimeSec;
  const progress = (elapsed % teleprompterSeconds) / teleprompterSeconds;

  const th = teleEl.scrollHeight || 900;
  const startY = 20;
  const endY = -th - 20;

  const y = startY + (endY - startY) * progress;
  teleEl.style.transform = `translateY(${y}px)`;

  teleprompterAnimationId = requestAnimationFrame(animateTele);
}

function applyAnswer(answer){
  const a = String(answer || "").trim();
  if(!a) return false;
  $("teleText").textContent = a;
  resetTeleprompter();
  stopTeleprompter();
  setCaptionClean(a);
  return true;
}

function setSpeed(seconds){
  teleprompterSeconds = seconds;
  $("speedLabel").textContent = `Vel: ${seconds}s`;
  $("speed120").checked = seconds === 120;
  $("speed105").checked = seconds === 105;
  $("speed90").checked  = seconds === 90;
}

/* CAMERA + REC (CANVAS CLEAN) */
let camStream = null;
let chunks = [];
let rafCanvasId = null;

let zoomValue = 1.0;
const camEl = $("cam");
const canvas = $("recCanvas");
const ctx = canvas.getContext("2d", { willReadFrequently: true });

async function applyZoom(v){
  zoomValue = Number(v) || 1;
  $("zoomVal").textContent = `${zoomValue.toFixed(1)}x`;
  document.documentElement.style.setProperty("--zoom", String(zoomValue));
}

function drawFrame(){
  const W = canvas.width, H = canvas.height;
  if(camEl.readyState < 2){
    ctx.fillStyle="black"; ctx.fillRect(0,0,W,H);
    return;
  }
  const vw = camEl.videoWidth || 1280;
  const vh = camEl.videoHeight || 720;

  const z = Math.max(1, Math.min(zoomValue, 5));
  const srcW = vw / z;
  const srcH = vh / z;
  const srcX = (vw - srcW)/2;
  const srcY = (vh - srcH)/2;

  ctx.drawImage(camEl, srcX, srcY, srcW, srcH, 0, 0, W, H);
}
function startCanvasLoop(){
  function loop(){
    drawFrame();
    rafCanvasId = requestAnimationFrame(loop);
  }
  loop();
}

async function startCamera(){
  if(camStream){
    camStream.getTracks().forEach(t=>t.stop());
    camStream = null;
  }
  try{
    camStream = await navigator.mediaDevices.getUserMedia({
      audio:true,
      video:{ facingMode:"user", width:{ideal:1280}, height:{ideal:720} }
    });
    camEl.srcObject = camStream;
    await new Promise(res => camEl.onloadedmetadata = () => res());
    try{ await camEl.play(); }catch(e){}
    if(!rafCanvasId) startCanvasLoop();
    return true;
  }catch(err){
    alert("Errore camera: " + err.message);
    return false;
  }
}
async function ensureReady(){
  if(!camStream){
    const ok = await startCamera();
    if(!ok) return false;
  }
  if(!rafCanvasId) startCanvasLoop();
  return true;
}

/* REC lamp */
let recStartTs = null;
let recTimerId = null;
let isRecording = false;
let recorder = null;

function fmtTime(ms){
  const sec = Math.floor(ms/1000);
  const m = String(Math.floor(sec/60)).padStart(2,"0");
  const s = String(sec%60).padStart(2,"0");
  return `${m}:${s}`;
}
function startRecLamp(){
  recStartTs = Date.now();
  $("recLamp").style.display = "flex";
  $("recTime").textContent = "REC 00:00";
  recTimerId = setInterval(()=> {
    $("recTime").textContent = `REC ${fmtTime(Date.now()-recStartTs)}`;
  }, 250);
}
function stopRecLamp(){
  $("recLamp").style.display = "none";
  if(recTimerId) clearInterval(recTimerId);
  recTimerId = null;
  recStartTs = null;
}

function downloadBlob(blob, filename){
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(()=>URL.revokeObjectURL(url), 2000);
}

/* Recordings */
let recordings = [];
let currentRecIndex = -1;

function updateVideoCounters(){
  $("videoCounter").textContent = `Video: ${totalVideos}`;
}

function renderRecList(){
  const box = $("recList");
  if(!recordings.length){ box.textContent = "‚Äî"; return; }

  box.innerHTML = recordings.map((r,i)=>{
    const active = i===currentRecIndex ? " style='color:#d8a23a; font-weight:950;'" : "";
    return `
      <div ${active} style="margin-bottom:10px;">
        <div>
          <a href="#" data-i="${i}" style="color:inherit; text-decoration:none;">
            ${r.title}
          </a>
        </div>
        <div style="opacity:.85; margin-top:6px;">${(r.question||"").slice(0,95)}</div>
      </div>
    `;
  }).join("");

  box.querySelectorAll("a[data-i]").forEach(a => a.addEventListener("click", (e)=>{
    e.preventDefault();
    const i = +a.dataset.i;
    currentRecIndex = i;
    $("playback").src = recordings[i].url;
    $("playback").play().catch(()=>{});
    renderRecList();
  }));
}

function buildVideoTitle(videoNum, platform, question){
  const k = keywordsFromQuestion(question) || "video";
  const p = platform || "noplatform";
  return `#${String(videoNum).padStart(3,"0")} ‚Ä¢ ${p} ‚Ä¢ ${k}`;
}
function buildFileName(videoNum, platform, question){
  const k = keywordsFromQuestion(question) || "video";
  const p = platform || "noplatform";
  return `video_${String(videoNum).padStart(3,"0")}_${p}_${k}_${nowStamp()}.webm`;
}

function startRecording(){
  if(!camStream){ alert("Attiva la camera."); return; }
  if(recorder && recorder.state !== "inactive"){ return; }

  startTeleprompter();
  chunks = [];

  const stream = canvas.captureStream(30);
  const audioTrack = camStream.getAudioTracks?.()[0];
  if(audioTrack) stream.addTrack(audioTrack);

  const mimeCandidates = [
    "video/webm;codecs=vp9,opus",
    "video/webm;codecs=vp8,opus",
    "video/webm"
  ];
  const mimeType = mimeCandidates.find(m => MediaRecorder.isTypeSupported(m)) || "";

  recorder = new MediaRecorder(stream, mimeType ? { mimeType } : undefined);

  recorder.ondataavailable = (e)=>{ if(e.data.size) chunks.push(e.data); };
  recorder.onstart = ()=>{ isRecording = true; startRecLamp(); };

  const qNow = String(currentQuestion || "").trim();
  const capNow = String(lastCaptionClean || "").trim();
  const platformNow = getActivePlatform();

  recorder.onstop = ()=>{
    stopRecLamp();
    stopTeleprompter();
    isRecording = false;

    const blob = new Blob(chunks, { type: recorder.mimeType || "video/webm" });
    totalVideos += 1;

    const title = buildVideoTitle(totalVideos, platformNow, qNow);
    const name = buildFileName(totalVideos, platformNow, qNow);
    const url = URL.createObjectURL(blob);

    recordings.unshift({ title, name, url, blob, question: qNow, captionClean: capNow, platform: platformNow, kind:"recorded" });
    currentRecIndex = 0;

    $("playback").src = url;
    $("playback").load();
    renderRecList();
    updateVideoCounters();

    advancePlatform();
    refreshProfileUI();
  };

  recorder.start(1000);
}
function stopRecording(){
  if(recorder && recorder.state !== "inactive") recorder.stop();
}

function goToDashboard(){
  if(confirm("Vuoi tornare al sistema principale?")){
    if(isRecording) stopRecording();
    setTimeout(()=> showTab('oggi'), 250);
  }
}

/* ISTRUZIONI MODAL */
function openInstructions(){
  const m = $("instructionsModal");
  m.classList.add("show");
  m.setAttribute("aria-hidden", "false");
}
function closeInstructions(){
  const m = $("instructionsModal");
  m.classList.remove("show");
  m.setAttribute("aria-hidden", "true");
}

function addUploadedVideo(file){
  if(!file) return;

  const url = URL.createObjectURL(file);
  totalVideos += 1;

  const platformNow = getActivePlatform();
  const qNow = String(currentQuestion || "Upload video").trim();
  const k = keywordsFromQuestion(qNow) || "upload";
  const p = platformNow || "upload";
  const title = `#${String(totalVideos).padStart(3,"0")} ‚Ä¢ ${p} ‚Ä¢ ${k} ‚Ä¢ UPLOAD`;

  const safeName = (file.name && file.name.trim()) ? file.name.trim() : `upload_${nowStamp()}.mp4`;

  const capNow = String(lastCaptionClean || "").trim();

  recordings.unshift({
    title,
    name: safeName,
    url,
    blob: file,
    question: qNow,
    captionClean: capNow,
    platform: platformNow,
    kind: "uploaded"
  });

  currentRecIndex = 0;
  $("playback").src = url;
  $("playback").load();
  renderRecList();
  updateVideoCounters();
}

// ============================================
// DASHBOARD FUNCTIONS (CODICE B)
// ============================================

function adjustDashboardCounter(type, amount) {
  dashboardCounters[type] = Math.max(0, dashboardCounters[type] + amount);
  saveDashboardCounters();
  updateDashboardCountersUI();
  
  // Aggiorna checklist automaticamente
  if (type === 'people' && dashboardCounters.people >= 20) {
    updateDashboardChecklistItem(2, true);
  }
  if (type === 'nominatives' && dashboardCounters.nominatives >= 1) {
    updateDashboardChecklistItem(2, true);
  }
  if (type === 'appointments' && dashboardCounters.appointments >= 1) {
    updateDashboardChecklistItem(3, true);
  }
}

function updateDashboardCountersUI() {
  if ($("kpiPeople")) $("kpiPeople").textContent = dashboardCounters.people;
  if ($("kpiNominatives")) $("kpiNominatives").textContent = dashboardCounters.nominatives;
  if ($("kpiAppointments")) $("kpiAppointments").textContent = dashboardCounters.appointments;
  if ($("kpiAssignments")) $("kpiAssignments").textContent = dashboardCounters.assignments;
  
  // Update status badges
  const statusEl = $("systemStatus");
  if (statusEl) {
    if (dashboardCounters.people < 20) {
      statusEl.className = 'status-badge status-pending';
      statusEl.textContent = 'INSUFFICIENTE';
    } else if (dashboardCounters.appointments === 0) {
      statusEl.className = 'status-badge status-warning';
      statusEl.textContent = 'DA MIGLIORARE';
    } else {
      statusEl.className = 'status-badge status-active';
      statusEl.textContent = 'OTTIMALE';
    }
  }
}

function renderDashboardChecklist() {
  const checklist = JSON.parse(localStorage.getItem(storageKeys.system_acq_checklist)) || defaultChecklist;
  const container = $("dailyChecklist");
  if (!container) return;
  
  container.innerHTML = '';
  
  checklist.forEach(item => {
    const div = document.createElement('div');
    div.className = 'checklist-item';
    div.innerHTML = `
      <input type="checkbox" ${item.done ? 'checked' : ''} id="check-${item.id}">
      <div class="checklist-item-content">
        <div class="checklist-item-title">${item.title}</div>
        <div class="checklist-item-desc">${item.desc}</div>
      </div>
    `;
    
    div.querySelector('input').addEventListener('change', (e) => {
      updateDashboardChecklistItem(item.id, e.target.checked);
    });
    
    container.appendChild(div);
  });
}

function updateDashboardChecklistItem(id, done) {
  let checklist = JSON.parse(localStorage.getItem(storageKeys.system_acq_checklist)) || defaultChecklist;
  const item = checklist.find(i => i.id === id);
  if (item) {
    item.done = done;
    localStorage.setItem(storageKeys.system_acq_checklist, JSON.stringify(checklist));
    renderDashboardChecklist();
  }
}

function saveDashboardCounters() {
  localStorage.setItem(storageKeys.system_acq_counters, JSON.stringify(dashboardCounters));
}

function loadDashboardCounters() {
  const saved = localStorage.getItem(storageKeys.system_acq_counters);
  if (saved) {
    dashboardCounters = JSON.parse(saved);
  }
}

function loadDashboardChecklist() {
  const saved = localStorage.getItem(storageKeys.system_acq_checklist);
  if (saved) {
    // Mantieni i default per nuovi item
    const savedList = JSON.parse(saved);
    const defaultIds = defaultChecklist.map(i => i.id);
    const newItems = defaultChecklist.filter(i => !savedList.some(s => s.id === i.id));
    const finalList = [...savedList, ...newItems];
    localStorage.setItem(storageKeys.system_acq_checklist, JSON.stringify(finalList));
  }
}

function saveDailyState() {
  const state = {
    date: $("todayDate") ? $("todayDate").value : new Date().toISOString().split('T')[0],
    zone: $("todayZone") ? $("todayZone").value : '',
    counters: dashboardCounters,
    timestamp: new Date().toISOString()
  };
  localStorage.setItem(storageKeys.system_acq_today, JSON.stringify(state));
  alert('Stato giornaliero salvato!');
}

function saveWeekPlan() {
  const plan = {
    label: $("weekLabel") ? $("weekLabel").value : '',
    dominant: $("dominantZone") ? $("dominantZone").value : '',
    days: {
      mon: $("dayMon") ? $("dayMon").value : '',
      tue: $("dayTue") ? $("dayTue").value : '',
      wed: $("dayWed") ? $("dayWed").value : '',
      thu: $("dayThu") ? $("dayThu").value : '',
      fri: $("dayFri") ? $("dayFri").value : ''
    },
    saved: new Date().toISOString()
  };
  localStorage.setItem(storageKeys.system_acq_week, JSON.stringify(plan));
  alert('Piano settimanale salvato!');
}

function applyDominantToAll() {
  const dominant = $("dominantZone") ? $("dominantZone").value : '';
  if (!dominant) {
    alert('Inserisci prima una zona dominante');
    return;
  }
  
  if ($("dayMon")) $("dayMon").value = dominant;
  if ($("dayTue")) $("dayTue").value = dominant;
  if ($("dayWed")) $("dayWed").value = dominant;
  if ($("dayThu")) $("dayThu").value = dominant;
  if ($("dayFri")) $("dayFri").value = dominant;
  
  alert('Zona dominante applicata a tutti i giorni!');
}

function runDiagnostics() {
  const issues = [];
  const logEl = $("diagnosisLog");
  if (!logEl) return;
  
  // Diagnosi basata sui contatori
  if (dashboardCounters.people < 20) {
    issues.push("üö® ERRORE 01: Meno di 20 persone parlate");
    issues.push("   ‚Üí Causa probabile: zona troppo grande/dispersa");
    issues.push("   ‚Üí Correzione: restringi micro-zona (1-2 isolati)");
  }
  
  if (dashboardCounters.people >= 20 && dashboardCounters.nominatives === 0) {
    issues.push("üö® ERRORE 02: 0 nominativi nonostante 20+ persone");
    issues.push("   ‚Üí Causa probabile: frase modificata o atteggiamento da venditore");
    issues.push("   ‚Üí Correzione: usa frase standard, sembra un sondaggio");
  }
  
  if (dashboardCounters.nominatives > 0 && dashboardCounters.appointments === 0) {
    issues.push("üö® ERRORE 03: 0 appuntamenti nonostante nominativi");
    issues.push("   ‚Üí Causa probabile: non chiedi data/ora precisa");
    issues.push("   ‚Üí Correzione: chiedi slot preciso, poi silenzio");
  }
  
  if (dashboardCounters.appointments > 0 && dashboardCounters.assignments === 0) {
    issues.push("‚ö†Ô∏è ATTENZIONE: Appuntamenti senza incarichi");
    issues.push("   ‚Üí Possibile causa: ordine operativo sbagliato");
    issues.push("   ‚Üí Verifica: Persona ‚Üí Motivo ‚Üí Tempo ‚Üí Casa ‚Üí Mercato ‚Üí Prezzo");
  }
  
  if (issues.length === 0) {
    issues.push("‚úÖ SISTEMA OTTIMALE");
    issues.push("   ‚Üí Tutti i KPI rispettati");
    issues.push("   ‚Üí Continua con esecuzione cieca");
  }
  
  if ($("lastDiagnosis")) $("lastDiagnosis").textContent = issues.length > 0 ? issues[0] : '‚Äî';
  logEl.textContent = issues.join('\n');
}

function generateDailyReport() {
  const report = `
REPORT GIORNALIERO - SYSTEM ACQ PRO
====================================
Data: ${$("todayDate") ? $("todayDate").value : new Date().toISOString().split('T')[0]}
Micro-zona: ${$("todayZone") ? $("todayZone").value || 'Non specificata' : 'Non specificata'}

KPI RAGGIUNTI:
- Persone parlate: ${dashboardCounters.people} (target: ‚â•20)
- Nominativi raccolti: ${dashboardCounters.nominatives} (target: ‚â•1)
- Appuntamenti fissati: ${dashboardCounters.appointments} (target: ‚â•1)
- Incarichi firmati: ${dashboardCounters.assignments}

STATUS SISTEMA: ${$("systemStatus") ? $("systemStatus").textContent : 'N/A'}

ANALISI AUTOMATICA:
${$("diagnosisLog") ? $("diagnosisLog").textContent : 'N/A'}

PRIORIT√Ä DOMANI:
1. __________
2. __________
3. __________

NOTA: Questo report √® generato automaticamente dal sistema.
`;
  
  alert(report);
}

function generateContentPlan() {
  const cta = $("ctaDigital") ? $("ctaDigital").value || 'VALORE' : 'VALORE';
  const plan = `
PIANO CONTENUTI 14 GIORNI - STRATEGIA POLARIZZANTE
==================================================

CTA UNICA: "Scrivimi ${cta}"

GIORNO 1-3: PREZZI REALI vs ILLUSIONI
‚Ä¢ Reel: "Il mito del 'proviamo pi√π alto' ti costa 6 mesi"
‚Ä¢ Post FB: "3 errori di pricing che bloccano la vendita"
‚Ä¢ Live: Q&A "Quanto vale davvero la tua casa in zona"

GIORNO 4-7: AGENZIE vs FAI DA TE
‚Ä¢ Reel: "Cosa paga davvero il venditore con le agenzie"
‚Ä¢ Post: "Esclusiva: perch√© senza perdi potere (e prezzo)"
‚Ä¢ Story: Screenshot DM reali (anonimizzati)

GIORNO 8-11: TEMPI REALI vs ASPETTATIVE
‚Ä¢ Reel: "Da 'ci penso' a venduto: timeline reale"
‚Ä¢ Post: "Statistiche mercato locale (dati reali)"
‚Ä¢ Video: Tour micro-zona + analisi prezzi

GIORNO 12-14: DOMINIO TERRITORIALE
‚Ä¢ Reel: "Come diventare 'quello di zona' in 30 giorni"
‚Ä¢ Post: "Case study: da 0 a 3 incarichi in 2 settimane"
‚Ä¢ Live: Strategia acquisizione passo-passo

REGOLA BASE: Ogni contenuto deve generare conversazione.
Se non genera ‚Üí cambiare approccio immediatamente.
`;
  
  alert(plan);
}

function resetDashboardDaily() {
  if (confirm('Vuoi resettare completamente la giornata? Tutti i contatori verranno azzerati.')) {
    dashboardCounters = { people: 0, nominatives: 0, appointments: 0, assignments: 0 };
    saveDashboardCounters();
    updateDashboardCountersUI();
    
    // Resetta checklist
    let checklist = JSON.parse(localStorage.getItem(storageKeys.system_acq_checklist)) || defaultChecklist;
    checklist.forEach(item => item.done = false);
    localStorage.setItem(storageKeys.system_acq_checklist, JSON.stringify(checklist));
    renderDashboardChecklist();
    
    alert('Giornata resettata!');
  }
}

// ============================================
// TAB SYSTEM (Unified)
// ============================================

function showTab(tabId) {
  // Rimuovi active da tutti
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  
  // Aggiungi active al tab cliccato
  const btn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
  const content = document.getElementById(`tab-${tabId}`);
  
  if (btn) btn.classList.add('active');
  if (content) content.classList.add('active');
  
  // Se mostri il tab video, inizializza i componenti specifici
  if (tabId === 'video') {
    initializeVideoCreator();
  }
}

function initializeVideoCreator() {
  // Inizializza solo se non √® gi√† stato fatto
  if (window.videoCreatorInitialized) return;
  
  // Carica prompt
  loadPrompt();
  lockPromptUI();
  
  // blocco risposta: vuoto di default
  if ($("answerBox")) $("answerBox").value = "";
  
  // restore caption preview only
  try{
    const savedCap = localStorage.getItem(storageKeys.vc_caption_clean) || "";
    if(savedCap.trim() && $("chkRememberCaption") && $("chkRememberCaption").checked){
      setCaptionClean(savedCap);
    }
  }catch(e){}
  
  $("teleText").textContent = "Incolla/scrivi una risposta in alto ‚Üí "Invia al teleprompter" ‚Üí "Teleprompter + REC".";
  showQuestionInOverlay("Premi "Nuova domanda".");
  updateVideoCounters();
  refreshProfileUI();
  renderRecList();
  resetTeleprompter();
  applyZoom(1.0);
  setSpeed(105);
  
  window.videoCreatorInitialized = true;
}

// ============================================
// INITIALIZATION (Both systems)
// ============================================

document.addEventListener("DOMContentLoaded", ()=>{
  // Setup tabs system
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tabId = btn.dataset.tab;
      showTab(tabId);
    });
  });
  
  // Inizializza Video Creator se siamo nel tab video
  if (document.querySelector('.tab-btn[data-tab="video"].active')) {
    initializeVideoCreator();
  }
  
  // Inizializza Dashboard
  loadDashboardCounters();
  loadDashboardChecklist();
  updateDashboardCountersUI();
  renderDashboardChecklist();
  
  // Data odierna per dashboard
  if ($("todayDate")) {
    const today = new Date();
    $("todayDate").value = today.toISOString().split('T')[0];
  }
  
  // ==========================
  // VIDEO CREATOR EVENT LISTENERS
  // ==========================
  
  // Back buttons
  if ($("btnBackTop")) $("btnBackTop").addEventListener("click", goToDashboard);
  if ($("btnBackBottom")) $("btnBackBottom").addEventListener("click", goToDashboard);
  
  // Istruzioni
  if ($("btnInstructions")) $("btnInstructions").addEventListener("click", openInstructions);
  if ($("btnInstructionsBottom")) $("btnInstructionsBottom").addEventListener("click", openInstructions);
  if ($("btnCloseInstructions")) $("btnCloseInstructions").addEventListener("click", closeInstructions);
  if ($("instructionsModal")) $("instructionsModal").addEventListener("click", (e)=>{
    if(e.target && e.target.id === "instructionsModal") closeInstructions();
  });
  document.addEventListener("keydown", (e)=>{
    if(e.key === "Escape") closeInstructions();
  });
  
  // speed radio-like
  if ($("speed120")) $("speed120").addEventListener("change", (e)=>{ if(e.target.checked) setSpeed(120); });
  if ($("speed105")) $("speed105").addEventListener("change", (e)=>{ if(e.target.checked) setSpeed(105); });
  if ($("speed90")) $("speed90").addEventListener("change", (e)=>{ if(e.target.checked) setSpeed(90); });
  
  // rotation change resets index
  ["rot_tiktok","rot_instagram","rot_shorts","rot_facebook"].forEach(id=>{
    if ($(id)) $(id).addEventListener("change", ()=>{
      rotationIndex = 0;
      refreshProfileUI();
    });
  });
  
  // nuova domanda
  if ($("btnNext")) $("btnNext").addEventListener("click", ()=> nextQuestion());
  
  // apri chatgpt + copia prompt+domanda
  if ($("btnOpenChatGPTPasteQ")) $("btnOpenChatGPTPasteQ").addEventListener("click", async ()=>{
    if(!currentQuestion){
      nextQuestion();
    }
    const payload = composeChatGPTInput();
    await copyText(payload);
    window.open(CHATGPT_URL, "_blank", "noopener");
  });
  
  // incolla risposta
  if ($("btnPasteTop")) $("btnPasteTop").addEventListener("click", async ()=>{
    try{
      const t = await readClipboardText();
      if ($("answerBox")) $("answerBox").value = (t || "");
    }catch(e){
      alert("Clipboard bloccata: incolla manualmente nel blocco risposta.");
    }
  });
  
  // invia al teleprompter
  if ($("btnSendTele")) $("btnSendTele").addEventListener("click", ()=>{
    const ok = applyAnswer($("answerBox").value || "");
    if(!ok) alert("Scrivi o incolla una risposta prima.");
  });
  
  // camera
  if ($("btnCam")) $("btnCam").addEventListener("click", async ()=>{ await ensureReady(); });
  
  // Teleprompter + REC
  if ($("btnTeleRec")) $("btnTeleRec").addEventListener("click", async ()=>{
    const okCam = await ensureReady();
    if(!okCam) return;
    
    if(!currentQuestion){
      nextQuestion();
    }
    
    const ans = ($("answerBox").value || "").trim();
    if(!ans){
      alert("Scrivi o incolla una risposta (o usa "Incolla risposta") prima di registrare.");
      return;
    }
    
    applyAnswer(ans);
    startRecording();
  });
  
  if ($("btnStop")) $("btnStop").addEventListener("click", ()=> stopRecording());
  if ($("btnRestart")) $("btnRestart").addEventListener("click", ()=> restartTeleprompter());
  if ($("zoom")) $("zoom").addEventListener("input", (e)=> applyZoom(e.target.value));
  
  // remember caption toggle
  if ($("chkRememberCaption")) $("chkRememberCaption").addEventListener("change", ()=>{
    if(!$("chkRememberCaption").checked){
      try{ localStorage.removeItem(storageKeys.vc_caption_clean); }catch(e){}
    }else{
      try{ localStorage.setItem(storageKeys.vc_caption_clean, lastCaptionClean || ""); }catch(e){}
    }
  });
  
  // copia caption
  if ($("btnCopyCaption")) $("btnCopyCaption").addEventListener("click", async ()=>{
    const out = captionWithHashtagsIfNeeded(lastCaptionClean);
    if(!out){ alert("Niente da copiare."); return; }
    await copyText(out);
  });
  
  // download selected video
  if ($("btnDownloadVideo")) $("btnDownloadVideo").addEventListener("click", ()=>{
    if(currentRecIndex < 0 || !recordings[currentRecIndex]){
      alert("Seleziona un video dalla lista.");
      return;
    }
    const r = recordings[currentRecIndex];
    downloadBlob(r.blob, r.name);
  });
  
  // upload video (button -> hidden input)
  if ($("btnUploadVideo")) $("btnUploadVideo").addEventListener("click", ()=>{
    if ($("videoUpload")) $("videoUpload").click();
  });
  if ($("videoUpload")) $("videoUpload").addEventListener("change", (e)=>{
    const file = e.target.files && e.target.files[0];
    if(!file) return;
    if(!String(file.type || "").startsWith("video/")){
      alert("Seleziona un file video valido.");
      e.target.value = "";
      return;
    }
    addUploadedVideo(file);
    e.target.value = "";
  });
  
  // clear list
  if ($("btnClearList")) $("btnClearList").addEventListener("click", ()=>{
    if(!recordings.length) return;
    if(confirm("Svuotare la lista?")){
      recordings.forEach(r => { try{ URL.revokeObjectURL(r.url); }catch(e){} });
      recordings = [];
      currentRecIndex = -1;
      if ($("playback")) {
        $("playback").removeAttribute("src");
        $("playback").load();
      }
      renderRecList();
      totalVideos = 0;
      updateVideoCounters();
      rotationIndex = 0;
      refreshProfileUI();
    }
  });
  
  // prompt unlock/save/reset
  if ($("btnUnlock")) $("btnUnlock").addEventListener("click", ()=>{
    const code = ($("unlockCode").value || "").trim();
    if(code === UNLOCK_CODE){
      unlockPromptUI();
    }else{
      alert("Codice errato.");
      lockPromptUI();
    }
  });
  
  if ($("btnSavePrompt")) $("btnSavePrompt").addEventListener("click", ()=>{
    savePrompt();
    lockPromptUI();
    if ($("unlockCode")) $("unlockCode").value = "";
  });
  
  if ($("btnResetPrompt")) $("btnResetPrompt").addEventListener("click", ()=>{
    if ($("promptBox")) $("promptBox").value = BASE_PROMPT;
    savePrompt();
    lockPromptUI();
    if ($("unlockCode")) $("unlockCode").value = "";
  });
  
  // ==========================
  // SCARCITY TIMER
  // ==========================
  setInterval(() => {
    const counter = document.querySelector('.slot-counter');
    if (counter) {
      // Simula leggera variazione (non ingannevole)
      const base = 3;
      const random = Math.random() > 0.7 ? -1 : 0;
      const display = Math.max(1, base + random);
      counter.textContent = display;
    }
  }, 30000);
  
  // ==========================
  // WHATSAPP CLICK TRACKING
  // ==========================
  document.querySelectorAll('a[href*="whatsapp"]').forEach(link => {
    link.addEventListener('click', () => {
      console.log('WhatsApp CTA clicked');
    });
  });
});
</script>
</body>
</html>
