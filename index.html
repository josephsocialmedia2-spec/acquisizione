<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Creator 9:16 - Teleprompter Social</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1080px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            min-height: 100vh;
        }

        /* Video Recording Area */
        .recording-area {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .video-container {
            width: 100%;
            height: 500px;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        #video-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Question Display */
        .question-display {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            text-align: center;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            font-size: 18px;
            font-weight: 600;
            backdrop-filter: blur(10px);
            pointer-events: none;
            user-select: none;
        }

        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-top: 20px;
        }

        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            font-weight: 600;
        }

        .record-btn {
            background: #ff4757;
            color: white;
            box-shadow: 0 10px 20px rgba(255,71,87,0.3);
        }

        .record-btn.recording {
            animation: pulse 1.5s infinite;
            background: #ff3838;
        }

        .stop-btn {
            background: #2ed573;
            color: white;
            box-shadow: 0 10px 20px rgba(46,213,115,0.3);
        }

        .timer-display {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            min-width: 100px;
            text-align: center;
        }

        /* Channel Rotation */
        .channel-rotation {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .channel-title {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
            text-align: center;
        }

        .channels {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .channel {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            opacity: 0.5;
            transition: all 0.3s;
        }

        .channel.active {
            opacity: 1;
            transform: scale(1.1);
        }

        .channel-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .tiktok { background: #000; color: white; }
        .instagram { background: linear-gradient(45deg, #405de6, #5851db, #833ab4, #c13584, #e1306c, #fd1d1d); color: white; }
        .youtube { background: #ff0000; color: white; }
        .facebook { background: #1877f2; color: white; }

        /* Teleprompter Panel */
        .teleprompter-panel {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .teleprompter-display {
            flex: 1;
            background: #1a1a1a;
            border-radius: 15px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            min-height: 400px;
        }

        .teleprompter-text {
            color: rgba(255,255,255,0.8);
            font-size: 22px;
            line-height: 1.6;
            position: absolute;
            top: 100%;
            width: 100%;
            transition: top 0.1s linear;
            padding: 20px;
            text-align: center;
        }

        .teleprompter-text .word {
            margin: 0 5px;
            transition: all 0.3s;
            border-radius: 3px;
            padding: 2px 4px;
        }

        .teleprompter-text .word.active {
            background: #667eea;
            color: white;
            box-shadow: 0 0 10px rgba(102,126,234,0.5);
        }

        /* Speed Controls */
        .speed-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .speed-btn {
            padding: 12px 24px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .speed-btn.active {
            background: #667eea;
            color: white;
        }

        .speed-btn.slow:before { content: "üê¢ "; }
        .speed-btn.medium:before { content: "üö∂ "; }
        .speed-btn.fast:before { content: "üèÉ "; }

        /* Instructions Button */
        .instructions-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            z-index: 10;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #666;
        }

        /* WhatsApp Button */
        .whatsapp-btn {
            background: #25D366;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .whatsapp-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(37,211,102,0.3);
        }

        /* Video Library */
        .video-library {
            margin-top: 20px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .library-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .video-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .video-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .video-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes scroll {
            from { top: 100%; }
            to { top: -100%; }
        }
    </style>
</head>
<body>
    <!-- Instructions Button -->
    <button class="instructions-btn" onclick="openInstructions()">üìã Istruzioni Operatore</button>

    <div class="container">
        <!-- Left Column: Video Recording -->
        <div class="recording-area">
            <!-- Video Preview -->
            <div class="video-container">
                <video id="video-preview" autoplay muted></video>
                
                <!-- Question Display -->
                <div class="question-display" id="question-display">
                    Caricamento domanda...
                </div>
            </div>

            <!-- Controls -->
            <div class="controls">
                <div class="timer-display" id="timer">00:00</div>
                <button class="control-btn record-btn" id="record-btn" onclick="toggleRecording()">
                    REC
                </button>
                <button class="control-btn stop-btn" id="stop-btn" onclick="stopRecording()" disabled>
                    STOP
                </button>
            </div>

            <!-- Channel Rotation -->
            <div class="channel-rotation">
                <div class="channel-title">ROTAZIONE PRODUZIONE</div>
                <div class="channels">
                    <div class="channel" id="channel-tiktok">
                        <div class="channel-icon tiktok">TT</div>
                        <span>TikTok</span>
                    </div>
                    <div class="channel" id="channel-instagram">
                        <div class="channel-icon instagram">IG</div>
                        <span>Instagram</span>
                    </div>
                    <div class="channel" id="channel-youtube">
                        <div class="channel-icon youtube">YT</div>
                        <span>Shorts</span>
                    </div>
                    <div class="channel" id="channel-facebook">
                        <div class="channel-icon facebook">FB</div>
                        <span>Facebook</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Teleprompter -->
        <div class="teleprompter-panel">
            <div class="teleprompter-display" id="teleprompter-display">
                <div class="teleprompter-text" id="teleprompter-text">
                    Inserisci la tua risposta qui sotto per iniziare...
                </div>
            </div>

            <!-- Text Input -->
            <textarea 
                id="response-input" 
                placeholder="Scrivi la tua risposta qui. Diventer√† il teleprompter per il video..."
                rows="4"
                style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 16px; resize: none;"
                oninput="updateTeleprompter(this.value)"
            ></textarea>

            <!-- Speed Controls -->
            <div class="speed-controls">
                <button class="speed-btn slow" onclick="setSpeed(90)">90s</button>
                <button class="speed-btn medium" onclick="setSpeed(105)">105s</button>
                <button class="speed-btn fast active" onclick="setSpeed(120)">120s</button>
            </div>

            <!-- Video Library -->
            <div class="video-library">
                <div class="library-title">üìÅ LIBRERIA VIDEO</div>
                <div class="video-list" id="video-list">
                    <!-- Video items will be added here dynamically -->
                </div>
            </div>

            <!-- WhatsApp Button -->
            <button class="whatsapp-btn" onclick="sendToWhatsApp()">
                üì± Invia per pubblicazione
            </button>
        </div>
    </div>

    <!-- Instructions Modal -->
    <div class="modal" id="instructions-modal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeInstructions()">√ó</button>
            <h2>üìã Istruzioni Operatore</h2>
            <br>
            <h3>üéØ COME FUNZIONA</h3>
            <p>1. <strong>Domanda preset</strong> appare in alto (non modificabile)</p>
            <p>2. <strong>Scrivi la risposta</strong> nel box di testo</p>
            <p>3. <strong>Imposta velocit√†</strong> teleprompter (90/105/120s)</p>
            <p>4. <strong>Registra video</strong> leggendo il teleprompter</p>
            <p>5. <strong>Salva e pubblica</strong> sui social in rotazione</p>
            <br>
            <h3>üîß FUNZIONI PRINCIPALI</h3>
            <ul>
                <li><strong>Teleprompter Karaoke</strong>: parole evidenziate in tempo reale</li>
                <li><strong>Rotazione automatica</strong>: TikTok ‚Üí Instagram ‚Üí Shorts ‚Üí Facebook</li>
                <li><strong>Caption automatico</strong>: "josephcreatorlab" + hashtag</li>
                <li><strong>WhatsApp Integration</strong>: invio diretto per pubblicazione</li>
            </ul>
            <br>
            <h3>üìû CONTATTO</h3>
            <p>WhatsApp: <strong>+39 371 379 8294</strong></p>
            <p>Messaggio automatico: "Invia per pubblicazione"</p>
        </div>
    </div>

    <script>
        // DOM Elements
        const videoPreview = document.getElementById('video-preview');
        const questionDisplay = document.getElementById('question-display');
        const teleprompterText = document.getElementById('teleprompter-text');
        const recordBtn = document.getElementById('record-btn');
        const stopBtn = document.getElementById('stop-btn');
        const timerDisplay = document.getElementById('timer');
        const responseInput = document.getElementById('response-input');
        const videoList = document.getElementById('video-list');

        // Questions Database (random selection)
        const questions = [
            "Qual √® il consiglio pi√π prezioso che hai ricevuto nella tua carriera?",
            "Cosa ti motiva ogni giorno nel tuo lavoro?",
            "Qual √® stato il momento di svolta pi√π importante per te?",
            "Come gestisci gli insuccessi e le delusioni?",
            "Cosa diresti a te stesso di 10 anni fa?",
            "Qual √® la competenza pi√π sottovalutata nel tuo settore?",
            "Come mantieni l'equilibrio tra lavoro e vita privata?",
            "Cosa ti rende diverso dagli altri nel tuo campo?"
        ];

        // State Variables
        let mediaRecorder = null;
        let recordedChunks = [];
        let isRecording = false;
        let timer = 0;
        let timerInterval = null;
        let currentSpeed = 120;
        let currentChannel = 'tiktok';
        let currentQuestion = '';
        let teleprompterWords = [];
        let currentWordIndex = 0;
        let teleprompterInterval = null;
        let videos = JSON.parse(localStorage.getItem('videos')) || [];

        // Initialize
        function init() {
            loadRandomQuestion();
            updateChannelRotation();
            loadVideos();
            setupCamera();
            
            // Set default response text
            responseInput.value = "Grazie per questa domanda importante. Nella mia esperienza, il segreto del successo √®...";
            updateTeleprompter(responseInput.value);
        }

        // Load random question
        function loadRandomQuestion() {
            const randomIndex = Math.floor(Math.random() * questions.length);
            currentQuestion = questions[randomIndex];
            questionDisplay.textContent = currentQuestion;
        }

        // Setup camera
        async function setupCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: 1080,
                        height: 1920,
                        facingMode: 'user'
                    },
                    audio: true
                });
                videoPreview.srcObject = stream;
                
                // Setup media recorder
                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'video/webm;codecs=vp9',
                    videoBitsPerSecond: 2500000
                });

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = saveVideo;

            } catch (err) {
                console.error('Errore accesso camera:', err);
                alert('Impossibile accedere alla camera. Controlla i permessi.');
            }
        }

        // Toggle recording
        function toggleRecording() {
            if (!isRecording) {
                startRecording();
            } else {
                pauseRecording();
            }
        }

        // Start recording
        function startRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'recording') {
                recordedChunks = [];
                mediaRecorder.start();
                isRecording = true;
                recordBtn.textContent = 'PAUSA';
                recordBtn.classList.add('recording');
                stopBtn.disabled = false;
                
                // Start timer
                startTimer();
                
                // Start teleprompter
                startTeleprompter();
            }
        }

        // Pause recording
        function pauseRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.pause();
                isRecording = false;
                recordBtn.textContent = 'REC';
                recordBtn.classList.remove('recording');
                
                // Pause timer
                clearInterval(timerInterval);
                
                // Pause teleprompter
                clearInterval(teleprompterInterval);
            }
        }

        // Stop recording
        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                isRecording = false;
                recordBtn.textContent = 'REC';
                recordBtn.classList.remove('recording');
                stopBtn.disabled = true;
                
                // Stop timer
                clearInterval(timerInterval);
                timer = 0;
                updateTimerDisplay();
                
                // Stop teleprompter
                clearInterval(teleprompterInterval);
                resetTeleprompter();
            }
        }

        // Start timer
        function startTimer() {
            timer = 0;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timer++;
                updateTimerDisplay();
                
                // Auto stop at selected time
                if (timer >= currentSpeed) {
                    stopRecording();
                }
            }, 1000);
        }

        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(timer / 60);
            const seconds = timer % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Set teleprompter speed
        function setSpeed(seconds) {
            currentSpeed = seconds;
            
            // Update button states
            document.querySelectorAll('.speed-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Update teleprompter text
        function updateTeleprompter(text) {
            teleprompterText.innerHTML = text.split(' ').map(word => 
                `<span class="word">${word}</span>`
            ).join(' ');
            
            teleprompterWords = Array.from(teleprompterText.querySelectorAll('.word'));
            resetTeleprompter();
        }

        // Start teleprompter
        function startTeleprompter() {
            resetTeleprompter();
            currentWordIndex = 0;
            
            // Calculate scroll speed based on text length and time
            const totalWords = teleprompterWords.length;
            const wordsPerSecond = totalWords / currentSpeed;
            
            // Highlight words
            teleprompterInterval = setInterval(() => {
                if (currentWordIndex > 0) {
                    teleprompterWords[currentWordIndex - 1].classList.remove('active');
                }
                
                if (currentWordIndex < teleprompterWords.length) {
                    teleprompterWords[currentWordIndex].classList.add('active');
                    currentWordIndex++;
                    
                    // Scroll teleprompter
                    const scrollPercentage = (currentWordIndex / teleprompterWords.length) * 100;
                    const teleprompterHeight = document.querySelector('.teleprompter-display').offsetHeight;
                    teleprompterText.style.top = `${100 - scrollPercentage}%`;
                } else {
                    clearInterval(teleprompterInterval);
                }
            }, 1000 / wordsPerSecond);
        }

        // Reset teleprompter
        function resetTeleprompter() {
            clearInterval(teleprompterInterval);
            teleprompterWords.forEach(word => word.classList.remove('active'));
            teleprompterText.style.top = '100%';
            currentWordIndex = 0;
        }

        // Save video
        function saveVideo() {
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            const url = URL.createObjectURL(blob);
            const timestamp = new Date().toISOString();
            
            const videoData = {
                id: timestamp,
                url: url,
                question: currentQuestion,
                date: new Date().toLocaleString('it-IT'),
                channel: currentChannel,
                caption: `josephcreatorlab\n\n${currentQuestion}\n\n#video #content #socialmedia #${currentChannel} #success`
            };
            
            videos.unshift(videoData);
            localStorage.setItem('videos', JSON.stringify(videos));
            
            // Rotate to next channel
            rotateChannel();
            
            loadVideos();
        }

        // Load videos
        function loadVideos() {
            videoList.innerHTML = '';
            videos.slice(0, 6).forEach(video => {
                const videoItem = document.createElement('div');
                videoItem.className = 'video-item';
                videoItem.innerHTML = `
                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">${video.date.split(',')[0]}</div>
                    <div style="background: #000; height: 80px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; margin-bottom: 8px;">
                        ‚ñ∂Ô∏è
                    </div>
                    <div style="font-size: 11px; color: #333; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                        ${video.question.substring(0, 30)}...
                    </div>
                `;
                videoItem.onclick = () => downloadVideo(video);
                videoList.appendChild(videoItem);
            });
        }

        // Download video
        function downloadVideo(video) {
            const a = document.createElement('a');
            a.href = video.url;
            a.download = `video-${video.id}.webm`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Update channel rotation
        function updateChannelRotation() {
            document.querySelectorAll('.channel').forEach(channel => {
                channel.classList.remove('active');
            });
            document.getElementById(`channel-${currentChannel}`).classList.add('active');
        }

        // Rotate to next channel
        function rotateChannel() {
            const channels = ['tiktok', 'instagram', 'youtube', 'facebook'];
            const currentIndex = channels.indexOf(currentChannel);
            currentChannel = channels[(currentIndex + 1) % channels.length];
            updateChannelRotation();
        }

        // Send to WhatsApp
        function sendToWhatsApp() {
            const phoneNumber = '+393713798294';
            const message = encodeURIComponent('Invia per pubblicazione');
            window.open(`https://wa.me/${phoneNumber}?text=${message}`, '_blank');
        }

        // Instructions modal
        function openInstructions() {
            document.getElementById('instructions-modal').style.display = 'flex';
        }

        function closeInstructions() {
            document.getElementById('instructions-modal').style.display = 'none';
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
