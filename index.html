<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VIDEO ACQ ‚Äî Acquisizione Subito</title>
<style>
/* === PATCH: ACQUISIZIONE SUBITO (OVERLAY) === */
#acqOverlay{
  position:fixed; inset:0; background:rgba(2,6,23,.96); color:#fff; z-index:2000;
  display:none; overflow:auto;
}
#acqBox{
  max-width:720px; margin:20px auto; padding:16px;
  background:#0b1228; border:1px solid rgba(255,255,255,.12); border-radius:14px;
}
#acqBox h2{margin:0 0 10px; color:#fbbf24}
.cmd{font-size:22px; font-weight:900; line-height:1.15}
.sub{opacity:.8; margin:8px 0 12px}
.phrase{background:#020617; border:1px solid rgba(255,255,255,.12); border-radius:12px; padding:12px}
.phrase b{display:block; margin-bottom:6px}
.field{width:100%; padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,.12); background:#020617; color:#fff; margin:8px 0}
.grid{display:grid; grid-template-columns:1fr 1fr; gap:10px}
@media(max-width:520px){.grid{grid-template-columns:1fr}}
.chk{display:flex; gap:10px; align-items:flex-start; padding:10px; border:1px solid rgba(255,255,255,.12); border-radius:12px; margin:8px 0; background:rgba(255,255,255,.03)}
.chk input{width:20px;height:20px}
.btn{width:100%; padding:14px; border-radius:12px; border:none; font-weight:900; font-size:16px; margin:8px 0; cursor:pointer}
.red{background:#ef4444;color:#fff}
.green{background:#10b981;color:#052e1b}
.blue{background:#1e293b;color:#fff}
.row{display:flex; gap:8px; flex-wrap:wrap}
.pill{padding:8px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.12); background:rgba(255,255,255,.05)}
.small{opacity:.75; font-size:12px}
</style>
</head>
<body>

<!-- QUICK ACTION BUTTON -->
<button class="btn green" style="position:fixed;bottom:20px;left:20px;z-index:1500"
        onclick="openAcq()">‚ñ∂ ACQUISIZIONE SUBITO</button>

<!-- OVERLAY -->
<div id="acqOverlay">
  <div id="acqBox">
    <h2>ACQUISIZIONE SUBITO</h2>
    <div class="cmd">VAI IN <span id="zBig">VIA ROMA</span><br>PARTI DAL CIVICO 1<br>FERMA LA PRIMA PERSONA</div>
    <div class="sub">Checklist ‚Üí Video ‚Üí Invio WhatsApp</div>

    <input class="field" id="zona" placeholder="Micro-zona" value="Via Roma">

    <div class="phrase">
      <b>LEGGI QUESTO (UGUALE SEMPRE)</b>
      <p>‚ÄúCiao, sto lavorando con proprietari della zona per capire se qualcuno sta valutando di vendere nei prossimi mesi. Anche solo per informazione, posso farti 2 domande veloci?‚Äù</p>
    </div>

    <div class="grid">
      <input class="field" id="nome" placeholder="Nome">
      <input class="field" id="contatto" placeholder="Telefono / WhatsApp">
    </div>
    <input class="field" id="next" placeholder="Next step (obbligatorio)">

    <div class="chk"><input type="checkbox" id="c1"><b>Persona fermata</b></div>
    <div class="chk"><input type="checkbox" id="c2"><b>Frase detta</b></div>
    <div class="chk"><input type="checkbox" id="c3"><b>Nome raccolto</b></div>
    <div class="chk"><input type="checkbox" id="c4"><b>Contatto raccolto</b></div>
    <div class="chk"><input type="checkbox" id="c5"><b>Next step segnato</b></div>
    <div class="chk"><input type="checkbox" id="c6"><b>Video registrato</b></div>

    <div class="row">
      <div class="pill">Persone <b id="kP">0</b></div>
      <div class="pill">Nominativi <b id="kL">0</b></div>
      <div class="pill">Appuntamenti <b id="kA">0</b></div>
    </div>

    <div class="row">
      <label class="btn red" for="vid">üî¥ REC VIDEO</label>
      <input id="vid" type="file" accept="video/*" capture="environment" style="display:none">
    </div>

    <button class="btn green" id="send" disabled>üì§ INVIA A JOSEPH</button>
    <button class="btn blue" onclick="closeAcq()">CHIUDI</button>
    <div class="small" id="st"></div>
  </div>
</div>

<script>
const PHONE="393713708294";
const $=id=>document.getElementById(id);
let counters={p:0,l:0,a:0}, file=null;

function openAcq(){ $("acqOverlay").style.display="block"; }
function closeAcq(){ $("acqOverlay").style.display="none"; }

$("zona").oninput=()=>{$("zBig").textContent=($("zona").value||"Via Roma").toUpperCase();};
$("nome").oninput=()=>{$("c3").checked=!!$("nome").value; refresh();};
$("contatto").oninput=()=>{$("c4").checked=!!$("contatto").value; refresh();};
$("next").oninput=()=>{$("c5").checked=!!$("next").value; refresh();};

$("vid").onchange=()=>{
  file=$("vid").files[0]||null;
  $("c6").checked=!!file;
  $("st").textContent=file?"Video pronto":"";
  refresh();
};

["c1","c2","c3","c4","c5","c6"].forEach(id=>$(id).onchange=refresh);

function ok(){
  return ["c1","c2","c3","c4","c5","c6"].every(id=>$(id).checked)
    && $("nome").value && $("contatto").value && $("next").value && file;
}
function refresh(){ $("send").disabled=!ok(); }

$("send").onclick=async()=>{
  const txt=`ACQUISIZIONE\nZona: ${$("zona").value}\nNome: ${$("nome").value}\nContatto: ${$("contatto").value}\nNext: ${$("next").value}`;
  try{
    const f=new File([file], file.name||"acq.mp4", {type:file.type||"video/mp4"});
    if(navigator.canShare && navigator.canShare({files:[f]})){
      await navigator.share({files:[f], text:txt, title:"Acquisizione"});
      return;
    }
  }catch(e){}
  window.location.href=`https://wa.me/${PHONE}?text=${encodeURIComponent(txt)}`;
};
</script>
</body>
</html>
