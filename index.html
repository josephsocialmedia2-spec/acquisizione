<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Video Creator â€“ Chat + Teleprompter</title>

<style>
/* ==========================
   THEME (LAYOUT ORIGINALE)
========================== */
:root{
  --bg:#0b1120;
  --text:#f3f4f6;
  --muted:#a0adb8;
  --gold:#d8a23a;
  --border: rgba(225,225,225,0.18);
  --shadow: 0 14px 50px rgba(0,0,0,0.45);
  --radius: 18px;
  --zoom:1;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  color:var(--text);
  background:var(--bg);
}
.wrap{max-width:1150px;margin:0 auto;padding:14px 12px 90px}
.card{
  background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  overflow:hidden;
}
.section{padding:12px}
.h{
  margin:0 0 8px;
  font-size:10px;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:.8px;
  font-weight:950;
}
.btn{
  border:1px solid var(--border);
  background:rgba(255,255,255,.05);
  color:var(--text);
  padding:8px 10px;
  border-radius:12px;
  font-weight:950;
  cursor:pointer;
}
.btn.primary{
  background:linear-gradient(135deg,#ff2d2d,#c91f1f);
  border:none;
  color:#120707;
}
.btn.circle{
  width:72px;height:72px;border-radius:50%;
  font-weight:1000;
}
.layout{
  display:grid;
  grid-template-columns:1fr 360px;
  gap:12px;
}
@media(max-width:980px){.layout{grid-template-columns:1fr}}
.stage{
  width:min(420px,92vw);
  aspect-ratio:9/16;
  background:#000;
  border-radius:18px;
  overflow:hidden;
  position:relative;
  margin:auto;
}
video{
  position:absolute;inset:0;
  width:100%;height:100%;
  object-fit:cover;
  transform:scale(var(--zoom));
}
.overlay{
  position:absolute;inset:0;
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
  pointer-events:none;
}
#teleWrap{flex:1;overflow:hidden}
#teleText span{
  display:inline-block;
  padding:2px 4px;
}
#teleText span.active{
  background:rgba(216,162,58,.35);
  border-radius:6px;
}
#countdown{
  position:absolute;
  top:12px;right:12px;
  background:rgba(0,0,0,.45);
  padding:6px 10px;
  border-radius:12px;
  font-weight:1000;
  display:none;
}
#recIcon{
  position:absolute;
  top:12px;left:12px;
  font-size:18px;
  display:none;
}
#logoOverlay{
  margin:auto;
  max-width:70%;
  opacity:.85;
}
#categoryOverlay{
  text-align:center;
  font-weight:950;
  font-size:11px;
}
#phoneOverlay{
  background:rgba(0,0,0,.45);
  padding:6px 10px;
  border-radius:12px;
  font-weight:1000;
  text-align:center;
}
.chatBox{
  max-height:220px;
  overflow:auto;
  background:rgba(0,0,0,.2);
  border:1px solid var(--border);
  border-radius:14px;
  padding:10px;
  font-size:12px;
}
.msg.user{color:#d8a23a;margin-bottom:6px}
.msg.ai{color:#f3f4f6;margin-bottom:10px}
textarea,input[type="text"]{
  width:100%;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.2);
  color:var(--text);
  font-size:12px;
}
.controls{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="wrap">

<div class="layout">

<!-- MAIN -->
<div class="card">
<div class="section">
<p class="h">Video 9:16 + Teleprompter</p>

<div class="stage">
  <video id="cam" autoplay muted playsinline></video>
  <div class="overlay">
    <img id="logoOverlay">
    <div id="categoryOverlay"></div>
    <div id="teleWrap"><div id="teleText"></div></div>
    <div id="phoneOverlay"></div>
  </div>
  <div id="countdown">60</div>
  <div id="recIcon">ðŸŽ¥</div>
</div>

<div class="controls">
  <button class="btn" id="flipCam">ðŸ”„</button>
  <button class="btn" id="flashBtn">ðŸ’¡</button>
  <button class="btn primary btn.circle" id="recBtn">REC</button>
</div>

</div>
</div>

<!-- SIDE -->
<div class="card">
<div class="section">
<p class="h">Chat (copia / incolla)</p>
<div class="chatBox" id="chat"></div>
<textarea id="chatInput" placeholder="Scrivi o incolla la domanda"></textarea>
<button class="btn" id="sendQ">Invia</button>
<textarea id="chatAnswer" placeholder="Incolla qui la risposta"></textarea>
<button class="btn" id="useAnswer">Usa risposta</button>
</div>

<div class="section">
<p class="h">Overlay</p>
<input id="phoneInput" placeholder="Numero telefono">
<input type="file" id="logoInput" accept="image/*">
</div>
</div>

</div>
</div>

<script>
let facing="user",stream=null,recorder=null,chunks=[];
let words=[],teleIdx=0,timer=null,count=60;

/* CAMERA */
async function startCam(){
  if(stream) stream.getTracks().forEach(t=>t.stop());
  stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:facing},audio:true});
  cam.srcObject=stream;
}
startCam();

/* CHAT */
sendQ.onclick=()=>{
  chat.innerHTML+=`<div class="msg user">TU: ${chatInput.value}</div>`;
  chat.scrollTop=9999;
};
useAnswer.onclick=()=>{
  chat.innerHTML+=`<div class="msg ai">IA: ${chatAnswer.value}</div>`;
  prepareTele(chatAnswer.value);
  chatAnswer.value="";
};

/* TELEPROMPTER */
function prepareTele(t){
  teleText.innerHTML="";
  words=t.split(" ");
  words.forEach(w=>{
    const s=document.createElement("span");
    s.textContent=w+" ";
    teleText.appendChild(s);
  });
  teleIdx=0;
}
function stepTele(){
  if(teleIdx>0) teleText.children[teleIdx-1].classList.remove("active");
  if(teleIdx<teleText.children.length){
    teleText.children[teleIdx].classList.add("active");
    teleIdx++;
  }
}

/* REC */
recBtn.onclick=()=>{
  if(recorder&&recorder.state==="recording"){recorder.stop();return;}
  chunks=[];
  recIcon.style.display="block";
  countdown.style.display="block";
  count=60;
  countdown.textContent=count;
  timer=setInterval(()=>{
    count--;stepTele();countdown.textContent=count;
    if(count<=0){clearInterval(timer);recorder.stop();}
  },1000);
  const canvas=document.createElement("canvas");
  canvas.width=1080;canvas.height=1920;
  const ctx=canvas.getContext("2d");
  const draw=()=>{ctx.drawImage(cam,0,0,1080,1920);requestAnimationFrame(draw)}
  draw();
  const out=canvas.captureStream(30);
  stream.getAudioTracks().forEach(t=>out.addTrack(t));
  recorder=new MediaRecorder(out);
  recorder.ondataavailable=e=>chunks.push(e.data);
  recorder.onstop=()=>{
    recIcon.style.display="none";
    countdown.style.display="none";
    const blob=new Blob(chunks,{type:"video/webm"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="video_"+Date.now()+".webm";
    a.click();
  }
  recorder.start();
};

/* FLIP / FLASH */
flipCam.onclick=()=>{facing=facing==="user"?"environment":"user";startCam();}
flashBtn.onclick=()=>{
  const t=stream.getVideoTracks()[0];
  if(t.getCapabilities().torch) t.applyConstraints({advanced:[{torch:!t.torchOn}]});
};

/* LOGO / PHONE */
logoInput.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>{logoOverlay.src=r.result;localStorage.setItem("logo",r.result)}
  r.readAsDataURL(e.target.files[0]);
};
const sl=localStorage.getItem("logo"); if(sl) logoOverlay.src=sl;

phoneInput.oninput=e=>{
  phoneOverlay.textContent="CHIAMA AL "+e.target.value;
  localStorage.setItem("phone",e.target.value);
};
const sp=localStorage.getItem("phone");
if(sp){phoneInput.value=sp;phoneOverlay.textContent="CHIAMA AL "+sp;}
</script>
</body>
</html>
